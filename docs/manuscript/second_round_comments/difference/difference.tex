\documentclass[pra,superscriptaddress,reprint,amsmath,amssymb,nofootinbib]{revtex4-2}
%DIF LATEXDIFF DIFFERENCE FILE
%DIF DEL old.tex   Wed Oct 18 10:56:30 2023
%DIF ADD new.tex   Wed Oct 18 11:00:58 2023

\usepackage{graphicx}
\usepackage{dcolumn}
\usepackage{subfiles} 
\usepackage{bm}
%for nice coloured hyperlinks:
\usepackage[usenames,dvipsnames]{xcolor}
\usepackage[pdftex,plainpages=false,colorlinks=true]{hyperref}
\usepackage[toc,page,title,titletoc,header]{appendix} 
\usepackage{multirow}
\usepackage{tabularx}
%\usepackage[bottom]{footmisc}
%\usepackage{caption}
%\usepackage{subcaption}
%\usepackage[bottom]{footmisc}
%\usepackage{soul}
\usepackage{algorithm}
\usepackage{algpseudocode}
\algnewcommand{\To}{\textbf{To }}
\algnewcommand\Input{\item[\textbf{Initialisation:}]}%
\algnewcommand\Output{\item[\textbf{Output:}]}%
\usepackage{booktabs}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%% AUTHORS - PLACE YOUR OWN COMMANDS HERE %%%%%

% notes
\newcommand{\han}{\textcolor{orange}}
\usepackage[caption=false]{subfig}

\usepackage[normalem]{ulem}

%\usepackage[section]{placeins} %ensures figures go in their section e.g https://tex.stackexchange.com/questions/279/how-do-i-ensure-that-figures-appear-in-the-section-theyre-associated-with


% units
\newcommand{\Hz}{\mathrm{Hz}}
\newcommand{\ms}{\mathrm{ms}}
\newcommand{\secs}{\mathrm{s}}


% variables
\newcommand{\omegahigh}{\omega_{\mathrm{high}}}
\newcommand{\omegalow}{\omega_{\mathrm{low}}}
\newcommand{\fgw}{f_{\mathrm{gw}}}
\newcommand{\fline}{f_{\mathrm{line}}}

\newcommand{\CSOneName}{\texttt{H1:PEM-CS\_MAINSMON\_EBAY\_1\_DQ}}

\newcommand{\StrainChanName}{\texttt{L1:DCS-CALIB\_STRAIN\_C01\_AR}}
\newcommand{\PEMChanName}{\texttt{L1:PEM-CS\_MAINSMON\_EBAY\_1\_DQ}}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%




%\let\oldfootnote\footnote
%\renewcommand{\footnote}[1]{%
%	\begingroup%
%	\linespread{1}%    % <- linespread for footnote: 1, 1.1, 1.2 etc
%	\oldfootnote{#1}%
%	\endgroup%
%}
%
%\interfootnotelinepenalty=10000






%%%%%%%%%%%%%%%%%%% TITLE PAGE %%%%%%%%%%%%%%%%%%%
%DIF PREAMBLE EXTENSION ADDED BY LATEXDIFF
%DIF UNDERLINE PREAMBLE %DIF PREAMBLE
\RequirePackage[normalem]{ulem} %DIF PREAMBLE
\RequirePackage{color}\definecolor{RED}{rgb}{1,0,0}\definecolor{BLUE}{rgb}{0,0,1} %DIF PREAMBLE
\providecommand{\DIFaddtex}[1]{{\protect\color{blue}\uwave{#1}}} %DIF PREAMBLE
\providecommand{\DIFdeltex}[1]{{\protect\color{red}\sout{#1}}}                      %DIF PREAMBLE
%DIF SAFE PREAMBLE %DIF PREAMBLE
\providecommand{\DIFaddbegin}{} %DIF PREAMBLE
\providecommand{\DIFaddend}{} %DIF PREAMBLE
\providecommand{\DIFdelbegin}{} %DIF PREAMBLE
\providecommand{\DIFdelend}{} %DIF PREAMBLE
\providecommand{\DIFmodbegin}{} %DIF PREAMBLE
\providecommand{\DIFmodend}{} %DIF PREAMBLE
%DIF FLOATSAFE PREAMBLE %DIF PREAMBLE
\providecommand{\DIFaddFL}[1]{\DIFadd{#1}} %DIF PREAMBLE
\providecommand{\DIFdelFL}[1]{\DIFdel{#1}} %DIF PREAMBLE
\providecommand{\DIFaddbeginFL}{} %DIF PREAMBLE
\providecommand{\DIFaddendFL}{} %DIF PREAMBLE
\providecommand{\DIFdelbeginFL}{} %DIF PREAMBLE
\providecommand{\DIFdelendFL}{} %DIF PREAMBLE
%DIF HYPERREF PREAMBLE %DIF PREAMBLE
\providecommand{\DIFadd}[1]{\texorpdfstring{\DIFaddtex{#1}}{#1}} %DIF PREAMBLE
\providecommand{\DIFdel}[1]{\texorpdfstring{\DIFdeltex{#1}}{}} %DIF PREAMBLE
\newcommand{\DIFscaledelfig}{0.5}
%DIF HIGHLIGHTGRAPHICS PREAMBLE %DIF PREAMBLE
\RequirePackage{settobox} %DIF PREAMBLE
\RequirePackage{letltxmacro} %DIF PREAMBLE
\newsavebox{\DIFdelgraphicsbox} %DIF PREAMBLE
\newlength{\DIFdelgraphicswidth} %DIF PREAMBLE
\newlength{\DIFdelgraphicsheight} %DIF PREAMBLE
% store original definition of \includegraphics %DIF PREAMBLE
\LetLtxMacro{\DIFOincludegraphics}{\includegraphics} %DIF PREAMBLE
\newcommand{\DIFaddincludegraphics}[2][]{{\color{blue}\fbox{\DIFOincludegraphics[#1]{#2}}}} %DIF PREAMBLE
\newcommand{\DIFdelincludegraphics}[2][]{% %DIF PREAMBLE
\sbox{\DIFdelgraphicsbox}{\DIFOincludegraphics[#1]{#2}}% %DIF PREAMBLE
\settoboxwidth{\DIFdelgraphicswidth}{\DIFdelgraphicsbox} %DIF PREAMBLE
\settoboxtotalheight{\DIFdelgraphicsheight}{\DIFdelgraphicsbox} %DIF PREAMBLE
\scalebox{\DIFscaledelfig}{% %DIF PREAMBLE
\parbox[b]{\DIFdelgraphicswidth}{\usebox{\DIFdelgraphicsbox}\\[-\baselineskip] \rule{\DIFdelgraphicswidth}{0em}}\llap{\resizebox{\DIFdelgraphicswidth}{\DIFdelgraphicsheight}{% %DIF PREAMBLE
\setlength{\unitlength}{\DIFdelgraphicswidth}% %DIF PREAMBLE
\begin{picture}(1,1)% %DIF PREAMBLE
\thicklines\linethickness{2pt} %DIF PREAMBLE
{\color[rgb]{1,0,0}\put(0,0){\framebox(1,1){}}}% %DIF PREAMBLE
{\color[rgb]{1,0,0}\put(0,0){\line( 1,1){1}}}% %DIF PREAMBLE
{\color[rgb]{1,0,0}\put(0,1){\line(1,-1){1}}}% %DIF PREAMBLE
\end{picture}% %DIF PREAMBLE
}\hspace*{3pt}}} %DIF PREAMBLE
} %DIF PREAMBLE
\LetLtxMacro{\DIFOaddbegin}{\DIFaddbegin} %DIF PREAMBLE
\LetLtxMacro{\DIFOaddend}{\DIFaddend} %DIF PREAMBLE
\LetLtxMacro{\DIFOdelbegin}{\DIFdelbegin} %DIF PREAMBLE
\LetLtxMacro{\DIFOdelend}{\DIFdelend} %DIF PREAMBLE
\DeclareRobustCommand{\DIFaddbegin}{\DIFOaddbegin \let\includegraphics\DIFaddincludegraphics} %DIF PREAMBLE
\DeclareRobustCommand{\DIFaddend}{\DIFOaddend \let\includegraphics\DIFOincludegraphics} %DIF PREAMBLE
\DeclareRobustCommand{\DIFdelbegin}{\DIFOdelbegin \let\includegraphics\DIFdelincludegraphics} %DIF PREAMBLE
\DeclareRobustCommand{\DIFdelend}{\DIFOaddend \let\includegraphics\DIFOincludegraphics} %DIF PREAMBLE
\LetLtxMacro{\DIFOaddbeginFL}{\DIFaddbeginFL} %DIF PREAMBLE
\LetLtxMacro{\DIFOaddendFL}{\DIFaddendFL} %DIF PREAMBLE
\LetLtxMacro{\DIFOdelbeginFL}{\DIFdelbeginFL} %DIF PREAMBLE
\LetLtxMacro{\DIFOdelendFL}{\DIFdelendFL} %DIF PREAMBLE
\DeclareRobustCommand{\DIFaddbeginFL}{\DIFOaddbeginFL \let\includegraphics\DIFaddincludegraphics} %DIF PREAMBLE
\DeclareRobustCommand{\DIFaddendFL}{\DIFOaddendFL \let\includegraphics\DIFOincludegraphics} %DIF PREAMBLE
\DeclareRobustCommand{\DIFdelbeginFL}{\DIFOdelbeginFL \let\includegraphics\DIFdelincludegraphics} %DIF PREAMBLE
\DeclareRobustCommand{\DIFdelendFL}{\DIFOaddendFL \let\includegraphics\DIFOincludegraphics} %DIF PREAMBLE
%DIF COLORLISTINGS PREAMBLE %DIF PREAMBLE
\RequirePackage{listings} %DIF PREAMBLE
\RequirePackage{color} %DIF PREAMBLE
\lstdefinelanguage{DIFcode}{ %DIF PREAMBLE
%DIF DIFCODE_UNDERLINE %DIF PREAMBLE
  moredelim=[il][\color{red}\sout]{\%DIF\ <\ }, %DIF PREAMBLE
  moredelim=[il][\color{blue}\uwave]{\%DIF\ >\ } %DIF PREAMBLE
} %DIF PREAMBLE
\lstdefinestyle{DIFverbatimstyle}{ %DIF PREAMBLE
	language=DIFcode, %DIF PREAMBLE
	basicstyle=\ttfamily, %DIF PREAMBLE
	columns=fullflexible, %DIF PREAMBLE
	keepspaces=true %DIF PREAMBLE
} %DIF PREAMBLE
\lstnewenvironment{DIFverbatim}{\lstset{style=DIFverbatimstyle}}{} %DIF PREAMBLE
\lstnewenvironment{DIFverbatim*}{\lstset{style=DIFverbatimstyle,showspaces=true}}{} %DIF PREAMBLE
%DIF END PREAMBLE EXTENSION ADDED BY LATEXDIFF

\begin{document}
\preprint{}

\title[test short title]{Adaptive cancellation of mains power interference in continuous gravitational wave searches with a hidden Markov model}% Force line breaks with \\
%\thanks{this would be a footnoted on the first page}%

%\input{authors.tex}

\author{Author 1, Author 2, etc. Kimpson, Suvorova, Liu, Melatos, Middleton, Evans, Moran, Meyers, any others?}
\date{\today}% It is always \today, today,
             %  but any date may be explicitly specified


\begin{abstract}
		Continuous gravitational wave searches with terrestrial, long-baseline interferometers are hampered by long-lived, narrowband features in the power spectral density of the detector noise, known as lines. Candidate GW signals which overlap spectrally with known lines are typically vetoed. Here we demonstrate a line subtraction method based on adaptive noise cancellation, using a recursive least squares algorithm, a common approach in electrical engineering applications \DIFdelbegin \DIFdel{, such as processing }\DIFdelend \DIFaddbegin \DIFadd{such as }\DIFaddend audio and biomedical \DIFdelbegin \DIFdel{signals}\DIFdelend \DIFaddbegin \DIFadd{signal processing}\DIFaddend . We validate the line subtraction method by combining it with a hidden Markov model, a standard continuous wave search tool, to detect a synthetic continuous wave signal with an unknown and randomly wandering frequency which overlaps with the strong mains power line at $60 \, {\rm Hz}$ in the Laser Interferometer Gravitational Wave Observatory. \DIFdelbegin \DIFdel{We show that the synthetic continuous wave signal can be successfully recovered once the 60 Hz line has been subtracted. }\DIFdelend The performance of the line subtraction method with respect to the characteristics of the 60 Hz line and the \DIFaddbegin \DIFadd{control }\DIFaddend parameters of the \DIFdelbegin \DIFdel{method is explored and quantified }\DIFdelend \DIFaddbegin \DIFadd{recursive least squares algorithm is quantified in terms of receiver operating characteristic curves}\DIFaddend .

\begin{description}
\item[DOI]
\end{description}
\end{abstract}



\maketitle	


\section{Introduction} \label{sec:intro}
Instrumental noise artifacts in gravitational wave (GW) searches with terrestrial, long-baseline interferometers are classified according to their duration and spectral properties.  Short-lived, non-stationary, recurrent noise events such as optomechanical glitches typically last for seconds and exhibit distinctive spectral signatures, e.g they can be chirp-like \cite{Blackburn2008,Aasi2012,Aasi2015,DetCharGW150914:2016,Glanzer2023}. Long-lived, quasi-stationary, broadband noise sources include seismic disturbances at low frequencies, test mass thermal fluctuations at intermediate frequencies, and photon shot noise at high frequencies \cite{AasiEtAlAdLIGO:2015,LIGOnoiseguide,VIROGnoise,Akutsu2021PTEP,Nguyen2021}. Long-lived narrowband spectral artifacts --- termed instrumental lines --- are caused by electrical subsystems (e.g. mains power, clocks, oscillators), mechanical subsystems (e.g. test mass and beam-splitter violin modes) and calibration processes \cite{CovasEtAl:2018}, although sometimes the origin of a specific feature is unknown. Instrumental lines are disruptive, especially for continuous wave (CW) searches where the target astrophysical signal is quasi-monochromatic and resembles the noise artifact spectrally. Many above-threshold candidates discovered in published CW searches are vetoed because they coincide with known instrumental lines \cite{Piccinni2022,Riles2023,Wette2023}, for instance, in data from Observing Run 3 (O3) with the Laser Interferometer Gravitational Wave Observatory (LIGO), Virgo and the Kamioka Gravitational Wave Detector (KAGRA)  \cite[e.g.][]{Ligo_lineveto1,ligo_lineveto2,ligo_lineveto3} \newline 


Several techniques have been implemented by the LIGO-Virgo-KAGRA (LVK) Collaboration to identify, characterize and suppress instrumental noise artifacts \cite{Davis2021,Davisgalaxies10010012}. Some techniques identify and veto an artifact (or gate data segments) based on its time-frequency signature \cite{Abbott2018CQVeto,Lee2021,Steltner2022Ph}. Other techniques perform offline noise subtraction with reference to auxiliary data from physical environmental monitors (PEMs) \cite{Driggers2012RScI,Tiwari2015,Davis2019,Driggers2019}. PEMs can be used to witness correlated noise and generate a reference signal directly or elucidate and quantify multichannel couplings \cite{Jung2022PRD,marin1997}. Additionally some techniques are based on machine learning \cite{Cuoco2020,Vajente2020PhR,OrmistonEtAl:2020,Yamamoto2023}. In CW searches specifically, the distinctive amplitude and frequency (Doppler) modulations associated with the Earth's rotation and revolution respectively can be exploited to discriminate between terrestrial noise artifacts and astrophysical signals \cite{Zhu2017PhRvD,JonesPhysRevD.106.123011}.  \newline 

In most  of the situations above, the practical effect of an instrumental line is to excise the relevant part of the observing band from a CW search. That is, if an \DIFdelbegin \DIFdel{above threshold }\DIFdelend \DIFaddbegin \DIFadd{above-threshold }\DIFaddend CW search candidate coincides with a known instrumental line, the candidate is vetoed under current practice without further analysis, \DIFdelbegin \DIFdel{such as }\DIFdelend \DIFaddbegin \DIFadd{e.g.\ without }\DIFaddend comparing the expected strength of the noise line with the measured strength of the candidate \footnote{A regularly updated log of narrowband instrumental lines in the LVK detector is maintained at \href{https://dcc.ligo.org/LIGO-T2100200/public}{dcc.ligo.org/LIGO-T2100200/public} for public reference.}. In this paper we take a first step towards lifting the above limitation. We introduce an adaptive noise cancellation (ANC) scheme  based on an adaptive recursive least squares (ARLS) method which suppresses narrowband noise proportional to a known PEM reference signal. We then apply the ANC scheme to a CW search algorithm based on a hidden Markov model (HMM)\DIFaddbegin \DIFadd{, }\DIFaddend which detects and tracks quasi-monochromatic GW signals with wandering frequency and has been tested and validated thoroughly in multiple LVK searches \cite{Suvorova2016PhRv,Piccinni2022,Riles2023,Wette2023}. We demonstrate with synthetic data that the ANC scheme and HMM algorithm together can successfully detect a GW signal lying under the 60 Hz mains power line, if the signal exceeds a well-defined minimum amplitude. The approach extends naturally to other instrumental lines, a topic for future work. \newline 

The paper is organized as follows. In Section \ref{sec:pgi} we outline a mathematical model for the 60 Hz mains power line and the PEM reference signal, and justify the assumptions of the model by reference to data from the LIGO Livingston interferometer.  In Section \ref{sec:method} we introduce ANC formulated as an ARLS method. In Section \ref{sec:results} we validate the ANC scheme on synthetic GW strain data, in conjunction with an HMM Viterbi algorithm, and demonstrate the successful recovery of a frequency-wandering CW signal. In Section \ref{sec:theroccurves} we quantify the performance of the HMM Viterbi algorithm and ANC scheme as a function of the key parameters of the mains power interference and ANC filter. Concluding remarks are \DIFdelbegin \DIFdel{given }\DIFdelend \DIFaddbegin \DIFadd{made }\DIFaddend in Section \ref{sec:conclusions}.

\section{\DIFdelbegin \DIFdel{Power grid }\DIFdelend \DIFaddbegin \DIFadd{Mains power }\DIFaddend interference} \label{sec:pgi}
The goal of this paper is to detect a quasi-monochromatic GW signal in a data stream contaminated by two kinds of noise: additive Gaussian noise which is fundamental and irreducible, and additive non-Gaussian interference from a long-lived narrow spectral feature which can be filtered out in principle given an accurately measured reference signal. For this work we consider the spectral line at 60 Hz that results from the North American alternating current \DIFdelbegin \DIFdel{power grid }\DIFdelend \DIFaddbegin \DIFadd{mains power }\DIFaddend as the additive non-Gaussian interference, as it is a long-standing impediment to many CW searches with the LIGO interferometers. In Section \ref{sec22} we briefly review the 60 Hz LIGO interference line before proceeding in Section \ref{sec21} to specify the assumed mathematical forms of the interference and reference signals. In Section \ref{sec23} we justify the assumptions of Section \ref{sec21} by analysing differential arm length (DARM channel) and environmental (\DIFdelbegin \DIFdel{power grid }\DIFdelend \DIFaddbegin \DIFadd{mains power }\DIFaddend monitoring) data from the LIGO interferometers. 


\subsection{LIGO 60 Hz Interference}  \label{sec22}
%Useful literature: https://journals.aps.org/prd/pdf/10.1103/PhysRevD.97.082002

LIGO data contains multiple long-duration narrow lines in addition to \DIFdelbegin \DIFdel{the usual }\DIFdelend Gaussian noise. These lines are shown in Figure \ref{fig:strainSensitivity} where we plot the amplitude spectral density of the GW strain channel \texttt{*:DCS-CALIB\_STRAIN\_C01\_AR} for both LIGO-Hanford (\texttt{H1}, orange curve) and LIGO-Livingston (\texttt{L1}, blue curve). The small amplitude \DIFdelbegin \DIFdel{random }\DIFdelend fluctuations are the result of Gaussian noise whereas the large amplitude spikes are the long-duration lines. The provision of mains power electricity in North America via an alternating current \DIFaddbegin \DIFadd{(AC) }\DIFaddend with frequency 60 Hz leads to a \DIFdelbegin \DIFdel{line in the power spectral density of the LIGO noise}\DIFdelend \DIFaddbegin \DIFadd{distinct line in Figure  \ref{fig:strainSensitivity}}\DIFaddend . The mains power couples to the GW strain channel, because the performance of the high-sensitivity electronic components within LIGO varies with respect to the input power voltage. Additionally, the magnetic fields that arise from the AC mains supply couple to magnets on optical components. \newline 

Some spectral lines are static, but the 60 Hz line wanders in time, due to variations in the load in the North American power grid. The wandering is displayed in the cascade plot in Figure \ref{fig:powerCascade}, where the amplitude spectral density of the output signal of the LIGO-Hanford PEM channel \CSOneName \, is plotted for 210 5-min samples stacked vertically. The peak of the amplitude spectral density varies from 59.969 Hz  to 60.053 Hz, across the 210 samples with an average value of 60.004 Hz. Its full width half maximum varies from 5.294 mHz to 29.377 mHz, with an average value of 10.749  mHz. For a full review of LIGO spectral artifacts, including the 60 Hz line, we refer the reader to \cite{CovasEtAl:2018}. \newline 


The $60 \, {\rm Hz}$ line occurs in the neighbourhood of plausible astrophysical signals. For example, mass quadrupole radiation from a rotating mountain on the Crab pulsar would be emitted at twice the star's spin frequency, viz. $30.2 \, {\rm Hz}$ \citep{Riles2023,Wette2023}.


\begin{figure}
	\begin{center}
		\includegraphics[width=\columnwidth]{images/sensitivity}
	\end{center}
	\caption{Sensitivity plot for LIGO-Hanford (orange) and LIGO-Livingston (blue) for a snapshot of data ($10.0$ minutes) from O3 (channel \texttt{*:DCS-CALIB\_STRAIN\_C01\_AR}, see Ref.~\cite{LIGO_O3, GWOSC:online}. The vertical axis plots the amplitude spectral density of the detector noise in units of Hz$^{-1/2}$, while the horizontal axis plots the observation frequency in units of Hz. The spectral line at $60\,{\rm Hz}$ is clearly visible as a spike rising three decades, along with multiple other instrumental lines at other frequencies.}\label{fig:strainSensitivity}
\end{figure}
\begin{figure}
	\includegraphics[width=\columnwidth]{images/new_cascade_O3_new}
	\caption{Cascade plot showing the temporal evolution of the amplitude spectral density (units: Hz$^{-1/2}$) of the LIGO-Hanford \DIFaddbeginFL \DIFaddFL{three-phase }\DIFaddendFL mains-power PEM monitor \CSOneName~ (corner station, phase 1) as a function of frequency (units: Hz). Each trace corresponds to $320\,{\rm s}$ ($\approx 5\,{\rm min}$) of data ($210$ traces stacked vertically). The peak of the mains power \DIFdelbeginFL \DIFdelFL{$60 \, {\rm Hz}$ }\DIFdelendFL line wanders by $\approx \pm 30$ mHz about its time-averaged frequency \DIFaddbeginFL \DIFaddFL{$60.004$ Hz}\DIFaddendFL .}
	\label{fig:powerCascade}
\end{figure}
%DIF <  the script for this plot is here on CIT
%DIF < /home/hannah.middleton/repositories/powerlines/powergridlines/plots/asd





%DIF < 
\DIFdelbegin %DIFDELCMD < 

%DIFDELCMD < %%%
%DIF < At each detector there are nine PEM for the power grid monitoring all three phases of power at the corner and two end stations at a sample rate of $1024\,{\rm Hz}$. 
\DIFdelend %https://arxiv.org/abs/1903.03866 useful for Jaranowski discussion
\subsection{Statement of the problem: signal and noise models}  \label{sec21}
Let $x(t)$ denote the scalar time series output by the GW strain channel of a LIGO-like long baseline interferometer. Suppose that $x(t)$ is sampled at discrete times $t_n$, with $1 \leq n \leq N$ and uniform sampling interval $\Delta t = t_n - t_{n-1}$. Let $r(t)$ denote the scalar time series output by the environmental reference channel relevant for filtering interference; here $r(t)$ is of one of the three phases of mains power measured at some reference point in the detector. The reference signal is usually sampled less frequently than $x(t)$ at discrete times $t_{n_k}$, with $1 \leq k \leq K$ and $1 \leq n_k \leq N$. We assume for the sake of convenience that every $t_{n_k}$ coincides with some $t_n$ for all $k$, but the condition is not essential. \newline 

The strain channel is composed of a gravitational wave signal $h(t)$, non-Gaussian interference $c(t)$ (sometimes called ``clutter") and Gaussian noise $n(t)$ in a linear combination,
\begin{eqnarray}
	x(t) = h(t) + c(t) + n(t) \ .
	\label{eq:data}
\end{eqnarray}
 In this paper the gravitational wave signal takes the form predicted by \citet{Jaranowski1998} for a biaxial rotor, e.g. a neutron star (NS) emitting gravitational waves at multiples of the star's spin frequency $f_{\star}$. The GW signal is quasi-monochromatic, amplitude-modulated by the rotation of the Earth and frequency-modulated by the Earth's orbital motion. The noise $n(t)$ is white with $\langle n(t_n) n(t_{n'})\rangle = \sigma_n^2 \delta_{n n'}$. Noise samples $n(t_n)$ are drawn from a Gaussian distribution with zero mean and variance $\sigma_n^2$. The interference $c(t)$ takes a form determined by instrumental processes but is generally a long-lived, narrowband spectral feature. We relate $c(t)$ to the mains voltage $r(t)$ in this paper. \newline 

 
 Mains power is characterized by three properties. First, the frequency is maintained at a constant value across the grid to a good approximation by internal grid mechanisms (effectively a phase locked loop), with central frequency $f_{\rm ac} = 60$ Hz in North America. A slow periodic modulation occurs around $f_{\rm ac}$ with a small amplitude $\Delta f_{\rm ac} \lesssim 0.5$ Hz and period $P$, which wanders randomly and uniformly in the range $0 \leq P \leq P_{\rm max}$. Second, the phase offset $\Theta(t)$ of the voltage $r(t)$ wanders stochastically. We assume that the phase noise is white and Gaussian, with $n_{\Theta}(t_n)$ drawn from a Gaussian distribution with zero mean and variance $\sigma_{\Theta}^2$, i.e. $\langle n_{\Theta} (t_n) n_{\Theta} (t_{n'})\rangle = \sigma^2_{\Theta} \delta_{n n'}$. Third, the voltage amplitude, $A_r(t)$, is random. We assume that samples $A_r(t)$ are distributed uniformly within $[A_{\rm ac} - \Delta A_{\rm ac} , A_{\rm ac} + \Delta A_{\rm ac}]$. We can then write the reference voltage as,
 \begin{eqnarray}
 	r(t) = A_r(t_n) \cos \left[ 2 \pi f_{\rm ac} t + \Theta(t)\right] +n_r(t_n) \ ,
 	\label{eq:voltage}
 \end{eqnarray}
with
 \begin{eqnarray}
\Theta(t) = 2 \pi \Delta f_{\rm ac} \cos\left[\frac{2 \pi t}{P(t_n)}\right] + n_{\Theta} (t_n) \ ,
\label{eq:voltage_theta}
\end{eqnarray}
%\begin{align}
%	r(t) &= \nonumber \\
%	& A_r(t_n) \cos \left( 2 \pi f_{\rm ac} t + 2 \pi \Delta f_{\rm ac} \cos\left(\frac{2 \pi t}{P(t_n)}\right) + n_{\Theta} (t_n)\right) \nonumber \\
%	& +w(t_n)
%	\label{eq:voltage}
%\end{align}
for $t_n \leq t \leq t_{n+1}$. That is, at time $t_n$, random variables $A_r(t_n)$, $P(t_n)$ and $n_{\Theta} (t_n)$ are drawn from the \DIFdelbegin \DIFdel{distribution }\DIFdelend \DIFaddbegin \DIFadd{distributions }\DIFaddend $\mathcal{U}[A_{\rm ac} - \Delta A_{\rm ac},A_{\rm ac} + \Delta A_{\rm ac} ]$, $\mathcal{U}[0, P_{\rm max}]$, and $\mathcal{N} [0, \sigma_{\Theta}^2]$ respectively\DIFaddbegin \DIFadd{, where $\mathcal{U}$ denotes uniform, and $\mathcal{N}$ denotes normal}\DIFaddend . Equation \eqref{eq:voltage} then steps forward over a time interval $\Delta t$; that is, $r(t)$ is discontinuous from one time step to the next due to random sampling. In Equation \eqref{eq:voltage}, $n_r(t_n)$ is the reference signal measurement noise at $t_n$, assumed to be white and Gaussian with $n_r(t_n)$ drawn from a Gaussian with zero mean and variance $\sigma_r^2$. All the white measurement and process noises are assumed to be independent \DIFaddbegin \DIFadd{for simplicity}\DIFaddend . \newline 

Mains power couples into the strain channel in various complicated ways, e.g. through electronic devices, or inductively through ambient magnetic fields. A central assumption in this work is that the interference in the strain channel is an exact, amplitude-scaled replica of the reference signal up to a delay $\tau_{\rm delay}$ which is attributed to spatial propagation between the PEM site and the GW-sensing apparatus. Hence we can express the interference as 
 \DIFdelbegin \DIFdel{, 
 }\DIFdelend \begin{align}
	c(t) = A_c(t_n - \tau_{\rm delay}) \cos \biggl [ & 2 \pi f_{\rm ac} (t_n - \tau_{\rm delay}) \nonumber \\ 
	&+ \Theta(t_n - \tau_{\rm delay}	) \biggr ] \ ,
	\label{eq:vclutter}
\end{align}
for $t_n \leq t \leq t_{n+1}$. The amplitude $A_c$ is distributed as $\mathcal{U}[A_{\rm ac}- \Delta A_{\rm ac} ,A_{\rm ac} + \Delta A_{\rm ac} ]$. For this work we consider $0 \leq \tau_{\rm delay} \leq 10 \Delta t$, but wider or narrower ranges are possible and straightforward to implement. The assumption that $c(t)$ is a scaled replica of $r(t)$ is tested in Section \ref{sec23}.




\subsection{Coherence between $x(t)$ and $r(t)$}  \label{sec23}
A key assumption in Section \ref{sec21} is that the 60 Hz interference recorded in the reference PEM channel is also present in the strain channel. That is, the mains voltage recorded by the PEM is imprinted onto the strain channel up to a proportionality constant and time delay. In order to test this assumption we calculate the coherence between the strain channel and the PEM channel. \newline 

The coherence between two time series $x(t)$ and $r(t)$ is given by 
\begin{equation}
	C_{xr}(f)	= \frac{|P_{xr}(f)|^2}{P_{xx}(f) P_{rr}(f)}  \label{eq:coherence}
\end{equation}
where $f$ is the \DIFdelbegin \DIFdel{frequency, }\DIFdelend \DIFaddbegin \DIFadd{Fourier frequency and }\DIFaddend $P_{xr}$ is the (cross) power spectral density
\DIFaddbegin \begin{equation}
	\DIFadd{P_{xr}(f)	= \int_{-\infty}^{\infty} R_{xr}(\tau) e^{-2 \pi i f \tau } d \tau    \label{eq:psd}
}\end{equation}
\DIFadd{for cross-correlation,
}\begin{equation}
	\DIFadd{R_{xr}(\tau) = \int_{-\infty}^{\infty} x(t) r(t+ \tau) dt \ .  \label{eq:cross-corr}
}\end{equation}
\DIFadd{$P_{xx}(f)$ and $P_{rr}(f)$ are defined analogously to Equation \eqref{eq:psd}. $R_{xx}(f)$ }\DIFaddend and \DIFdelbegin \DIFdel{$ 0 \leq C_{xr}(f) \leq 1$. }\DIFdelend \DIFaddbegin \DIFadd{$R_{rr}(f)$ are defined analogously to Equation \eqref{eq:cross-corr}. In Equation \eqref{eq:coherence} $0 \leq C_{xr}(f) \leq 1$. }\DIFaddend $C_{xr}(f) = 0$ indicates that the two signals are completely unrelated, whilst $C_{xr}(f) = 1$ indicates that the two signals have an ideal, noiseless, linear relationship\DIFdelbegin \DIFdel{i.e. }\DIFdelend \DIFaddbegin \DIFadd{, i.e. the convolution }\DIFaddend $x(t) = g(t) \ast r(t)$ for impulse response function $g(t)$.  \DIFdelbegin \DIFdel{If }\DIFdelend \DIFaddbegin \DIFadd{The intermediate situation }\DIFaddend $ 0 < C_{xr}(f) < 1$ \DIFdelbegin \DIFdel{then this }\DIFdelend indicates that the relationship between $x(t)$ and $r(t)$ is non-linear, either due to measurement noise or \DIFdelbegin \DIFdel{else }\DIFdelend contributions to $x(t)$ from additional signals. Heuristically, for linear systems, $C_{xr}(f)$ can be understood as the fraction of the power in $x(t)$ that is produced by $r(t)$, at \DIFaddbegin \DIFadd{Fourier frequency }\DIFaddend $f$. \newline 


We use data for the strain and PEM channels from the first part of the third LIGO observing run, O3a \cite{LIGO_O3}. These data are obtained via the LIGO Data Grid  \footnote{\url{https://computing.docs.ligo.org/guide/computing-centres/ldg/}} using the \texttt{GWPy} package \cite{gwpy}. In O3a there are nine independent PEM channels at both LIGO-Livingston and LIGO-Hanford that directly measure the mains voltage \footnote{\url{https://git.ligo.org/detchar/ligo-channel-lists/-/blob/master/O3/L1-O3-pem.ini}}. In this paper we consider just the LIGO-Livingston data, as they suffice to make the point. Specifically, there are 3 PEM mains voltage monitors in the electronics bay in each of the X-arm end station (\texttt{EX}), the Y-arm end station (\texttt{EY}) and the corner station (\texttt{CS}). Each of the three PEMs at each station measures a separate component of three-phase mains power. The strain data are sampled at 16384 Hz and downsampled to 1024 Hz to match the sampling rate of the PEM channels. \newline 
%https://arxiv.org/pdf/1812.05225.pdf

Figure \ref{coherenceplot_1} displays $C_{xr}(f)$ \DIFdelbegin \DIFdel{between }\DIFdelend \DIFaddbegin \DIFadd{relating }\DIFaddend the high latency, calibrated strain channel \texttt{L1:DCS-CALIB\_STRAIN\_C01\_AR} and each of the nine reference PEM channels over a 10 minute interval. For all channels there is a clear spike in \DIFdelbegin \DIFdel{the }\DIFdelend $C_{xr}(f)$ at 60 Hz, with a mean amplitude $=0.85$ (unitless). \newline 

 It is important to note that whilst $C_{xr}(f=60 \text{Hz})$ \DIFdelbegin \DIFdel{between $x(t)$ and $r(t)$ }\DIFdelend is strong, it \DIFdelbegin \DIFdel{is also time variable}\DIFdelend \DIFaddbegin \DIFadd{also varies with time}\DIFaddend . Figure \ref{correlation_1} displays the coherence spectrogram, i.e. the time-varying coherence, between the strain channel and the PEM channel \PEMChanName \, (c.f. top panel, Figure \ref{coherenceplot_1}) over a \DIFdelbegin \DIFdel{1 hour }\DIFdelend \DIFaddbegin \DIFadd{1-hr }\DIFaddend time interval (c.f. the 10 minute interval of Figure \ref{coherenceplot_1}). \DIFdelbegin \DIFdel{$C_{xy}(f)$ }\DIFdelend \DIFaddbegin \DIFadd{$C_{xr}(f)$ }\DIFaddend is calculated in 10-s blocks; that is, every pixel in Figure \ref{correlation_1} is 10 s wide horizontally. We use a Fourier transform window of length 0.5 s, with each window overlapping by 0.25 s (c.f. Welch's method, \DIFaddbegin \DIFadd{Ref. }\DIFaddend \citep{Welch1161901}). \DIFdelbegin \DIFdel{Similar results are observed to }\DIFdelend \DIFaddbegin \DIFadd{The results resemble }\DIFaddend Figure \ref{coherenceplot_1}; there is a \DIFdelbegin \DIFdel{strong coherence (mean value =$0.73$) spectral feature at 60 Hz }\DIFdelend \DIFaddbegin \DIFadd{spectral feature with high coherence ($C_{xr}(f=60 \rm Hz) = 0.73$ on average) }\DIFaddend which persists across the full \DIFdelbegin \DIFdel{1 hour }\DIFdelend \DIFaddbegin \DIFadd{1-hr }\DIFaddend time interval. However, whilst the feature is persistent, $C_{xr}(f=60 \text{Hz})$ is not constant across the entire interval. Instead it changes in time, with \DIFdelbegin \DIFdel{a }\DIFdelend variance $=0.018$. These variations are \DIFdelbegin \DIFdel{evident }\DIFdelend \DIFaddbegin \DIFadd{visible }\DIFaddend in the changing colours of the spectrogram at 60 Hz, leading to \DIFdelbegin \DIFdel{an apparent }\DIFdelend ``patchiness" of the line. Additional features in the $C_{xr}(f)$ spectrum are seen near 0.2 kHz and 0.3 kHz, corresponding to instrumental lines recorded by the PEM which imprint onto the strain channel and are unrelated to the mains power. Similar results are obtained for the other PEM channels shown in Figure \ref{coherenceplot_1}	. Figures  \ref{coherenceplot_1} and  \ref{correlation_1} justify in part the assumptions in Section \ref{sec21}.
\begin{figure}
	\begin{center}
		\DIFdelbeginFL %DIFDELCMD < \includegraphics[width=\columnwidth]{images/stacked_coherence_plot}
%DIFDELCMD < 	%%%
\DIFdelendFL \DIFaddbeginFL \includegraphics[width=\columnwidth]{images/stacked_coherence_plot_new}
	\DIFaddendFL \end{center}
	\caption{\label{coherenceplot_1} Coherence \DIFdelbeginFL \DIFdelFL{$C_{xy}$}\DIFdelendFL \DIFaddbeginFL \DIFaddFL{$C_{xr}$}\DIFaddendFL , defined by Equation \eqref{eq:coherence}, \DIFdelbeginFL \DIFdelFL{between }\DIFdelendFL \DIFaddbeginFL \DIFaddFL{relating }\DIFaddendFL the LIGO-Livingston strain channel  \texttt{L1:DCS-CALIB\_STRAIN\_C01\_AR} and the nine \DIFaddbeginFL \DIFaddFL{three-phase }\DIFaddendFL mains-power PEM channels \DIFaddbeginFL \DIFaddFL{at the LIGO-Livingston end stations and corner station }\DIFaddendFL during a 10 minute observation interval. Clear features at 60 Hz are present in every \DIFdelbeginFL \DIFdelFL{channel}\DIFdelendFL \DIFaddbeginFL \DIFaddFL{panel}\DIFaddendFL , with amplitudes $ > 0.8$ (unitless).}
\end{figure}
\begin{figure*}
	\begin{center}
		\includegraphics[width=\textwidth]{images/coherence_spectrogram_canonical}
	\end{center}
	\caption{\label{correlation_1}
		Coherence spectrogram between the strain channel \StrainChanName  \, and the PEM channel \PEMChanName  	\, covering a 1 hour period of O3 data. The \DIFdelbeginFL \DIFdelFL{$x$-axis }\DIFdelendFL \DIFaddbeginFL \DIFaddFL{horizontal axis }\DIFaddendFL is the time in minutes from the start of O3a, \DIFdelbeginFL \DIFdelFL{separated }\DIFdelendFL \DIFaddbeginFL \DIFaddFL{divided }\DIFaddendFL into \DIFdelbeginFL \DIFdelFL{10s }\DIFdelendFL \DIFaddbeginFL \DIFaddFL{$10-{\rm s}$ }\DIFaddendFL bins. The \DIFdelbeginFL \DIFdelFL{$y$-axis }\DIFdelendFL \DIFaddbeginFL \DIFaddFL{vertical axis }\DIFaddendFL is the frequency in Hz. The pixel colour denotes the coherence \DIFdelbeginFL \DIFdelFL{$C_{xy}$}\DIFdelendFL \DIFaddbeginFL \DIFaddFL{$C_{xr}$}\DIFaddendFL , \DIFaddbeginFL \DIFaddFL{defined }\DIFaddendFL Equation \eqref{eq:coherence}, in that time-frequency bin\DIFaddbeginFL \DIFaddFL{; see colour bar at right (dimensionless)}\DIFaddendFL . \DIFdelbeginFL \DIFdelFL{A strong }\DIFdelendFL \DIFaddbeginFL \DIFaddFL{High }\DIFaddendFL coherence is observed at 60 Hz due to the \DIFdelbeginFL \DIFdelFL{main }\DIFdelendFL \DIFaddbeginFL \DIFaddFL{mains }\DIFaddendFL power interference. Additional coherence features \DIFdelbeginFL \DIFdelFL{can also be observed }\DIFdelendFL \DIFaddbeginFL \DIFaddFL{are visible }\DIFaddendFL at 0.2 kHz and 0.3 kHz due to instrumental lines of a different provenance\DIFaddbeginFL \DIFaddFL{, }\DIFaddendFL c.f. Figure \ref{fig:strainSensitivity}.}
\end{figure*}



\section{ANC scheme}\label{sec:method}

\DIFdelbegin \DIFdel{Adaptive noise cancellation (ANC ) }\DIFdelend \DIFaddbegin \DIFadd{ANC }\DIFaddend is a method for \DIFdelbegin \DIFdel{recovering an estimate of an }\DIFdelend \DIFaddbegin \DIFadd{estimating an }\DIFaddend underlying signal corrupted or obscured by \DIFdelbegin \DIFdel{some additive noise}\DIFdelend \DIFaddbegin \DIFadd{additive noise, which is itself estimated independently }\DIFaddend \cite{Widrow1451965}. In contrast to other common optimal filtering methods (e.g. Wiener, Kalman) ANC \DIFdelbegin \DIFdel{requires }\DIFdelend \DIFaddbegin \DIFadd{assumes }\DIFaddend no \textit{a priori} \DIFdelbegin \DIFdel{knowledge }\DIFdelend \DIFaddbegin \DIFadd{model }\DIFaddend of either the signal or the noise. Instead, ANC makes use of a reference input\DIFaddbegin \DIFadd{, }\DIFaddend which is correlated in some unknown way with the noise in the primary \DIFdelbegin \DIFdel{signal}\DIFdelend \DIFaddbegin \DIFadd{data}\DIFaddend . The reference is filtered and subtracted from the primary data so as to recover the underlying signal. For our purposes, the primary \DIFdelbegin \DIFdel{timeseries }\DIFdelend \DIFaddbegin \DIFadd{data }\DIFaddend is the gravitational-wave strain channel, $x(t)$, \DIFaddbegin \DIFadd{described by }\DIFaddend Equation \eqref{eq:data}, and the reference is a PEM recording a mains voltage, $r(t)$, \DIFaddbegin \DIFadd{described by }\DIFaddend Equation \eqref{eq:voltage}. The objective of ANC is to remove the clutter $c(t)$ in Equation \eqref{eq:data} with the aid of $r(t)$ whilst leaving $h(t)$ \DIFdelbegin \DIFdel{i.e. the signal of interest, }\DIFdelend intact. \newline 

\subsection{Filter}

The first step in implementing ANC is to convert $r(t)$ into an estimate of the clutter, $\hat{c}(t)$. The clutter estimate is subtracted from the primary signal in the time domain, defining a residual
\begin{eqnarray}
	e(t) = x(t) - \hat{c}(t) \ .\label{eq:error_estimate}
\end{eqnarray}
In the limit $\hat{c}(t) \to c(t)$, one obtains	$e(t) \to h(t) + n(t)$ and recovers a \DIFdelbegin \DIFdel{noise cancelled }\DIFdelend \DIFaddbegin \DIFadd{noise-cancelled }\DIFaddend timeseries. The clutter estimate is modelled by a finite duration impulse response (FIR) filter,
\begin{eqnarray}
	\hat{c}_k = \mathbf{w}^{\intercal}\mathbf{u}_k \ . \label{clutter_estimate}
\end{eqnarray}
In Equation \eqref{clutter_estimate}, ${\hat c}_k = {\hat c}(t_{n_k})$ is the clutter estimate at the $n_k$-th time step , $\mathbf{u}_k$ is the tap-input vector composed of $M$ running samples of the reference signal arranged backwards in time,
 \begin{eqnarray}
 	\mathbf{u}_k &= [r_k, r_{k-1}, \dots, r_{k-M+1}] \ ,
 \end{eqnarray}
and $\mathbf{w}$ is the tap-weight vector,
 \begin{eqnarray}
	\mathbf{w} = [w_1, w_{2}, \dots, w_{M}] \ .
\end{eqnarray}

The goal of ANC is to determine the optimal tap weights $\mathbf{w}_{\rm opt}$, that minimise the mean square error cost function,
\begin{eqnarray}
	\mathbf{w}_{\rm opt} = \arg \min \sum_{k=1}^{K} \lambda^{K-k-1} |e_k|^2 \ , \label{eq:minim}
\end{eqnarray}
where $0 \leq \lambda \leq 1$ is a ``forgetting factor" which gives exponentially less weight to older samples and can be freely chosen. The choice of $\lambda$ in this paper is discussed in Section \ref{sec:ARLS}. The minimization problem described by Equation \eqref{eq:minim} can be solved in many ways. Here we implement an ARLS algorithm. The algorithm is outlined in Section \ref{sec:ARLS}\DIFaddbegin \DIFadd{.
}\DIFaddend 

\subsection{ARLS algorithm}
\label{sec:ARLS}

As its name implies, the ARLS algorithm is adaptive, in the sense that the weights $\mathbf{w}$ are continually updated based on new data. It is also recursive, in the sense that $\mathbf{w}$ \DIFdelbegin \DIFdel{are }\DIFdelend \DIFaddbegin \DIFadd{is }\DIFaddend updated iteratively as new data \DIFdelbegin \DIFdel{arrives}\DIFdelend \DIFaddbegin \DIFadd{arrive}\DIFaddend , rather than reprocessing all previous data. Abbreviated pseudocode is presented below for the sake of reproducibility and the reader's convenience. The reader is referred to standard signal processing textbooks, e.g. \cite{HaykinAdaptiveFT:2002} for more information. \newline 

ARLS proceeds as follows:

\begin{enumerate}
	\item Initialise the tap weights $\mathbf{w} = \mathbf{0}$. Initialise a covariance matrix ${\bf P} = \langle {\bf w} {\bf w}^{\rm T} \rangle = \delta^{-1} {\bf I}$ of rank $M$ for regularisation parameter $0 < \delta \ll 1$  and an $M \times M$ identity matrix $\mathbf{I}$ where the superscript $T$ symbolises transposition.
	\item For $1 \leq k \leq K$:
	\begin{enumerate}
		\item Estimate the clutter $\hat{c}_k$ from Equation \eqref{clutter_estimate}
		\item Calculate the residual $e_k$ from Equation \eqref{eq:error_estimate}
		\item Calculate the gain vector\DIFaddbegin \DIFadd{,
		}\DIFaddend \begin{eqnarray}
			\mathbf{g}_k = \frac{\mathbf{P} \mathbf{u}_k}{\lambda + \mathbf{u}_k^{\intercal}\mathbf{P} \mathbf{u}_k} \DIFaddbegin \DIFadd{\ .
		}\DIFaddend \end{eqnarray}
	\item Update the tap weights\DIFaddbegin \DIFadd{,
			}\DIFaddend \begin{eqnarray}
		\mathbf{w}_k = \mathbf{w}_{k-1} +  e_k \mathbf{g}_k  \DIFaddbegin \DIFadd{\ .
	}\DIFaddend \end{eqnarray}
	\item Update the covariance matrix\DIFaddbegin \DIFadd{,
}\DIFaddend \begin{eqnarray}
	\mathbf{P}_k =  \mathbf{P}_{k-1}  \lambda^{-1}  - \mathbf{g}_k \mathbf{u}_k^{\intercal}  \lambda^{-1} \mathbf{P}_{k-1} \DIFaddbegin \DIFadd{\ .
}\DIFaddend \end{eqnarray}

	\end{enumerate}

\end{enumerate}
The pseudocode is \DIFdelbegin \DIFdel{also illustrated }\DIFdelend \DIFaddbegin \DIFadd{depicted }\DIFaddend in Figure \ref{fig:arlsBlock} \DIFdelbegin \DIFdel{via }\DIFdelend \DIFaddbegin \DIFadd{as }\DIFaddend a block diagram. At time $t$ the filter receives the reference signal $r(t)$ and produces an estimate of the clutter $\hat{c}(t)$, given the current tap weights $\mathbf{w}$. By comparing $\hat{c}(t)$ with the strain data $x(t)$ a residual \DIFdelbegin \DIFdel{is calculated $e(t)$}\DIFdelend \DIFaddbegin \DIFadd{$e(t)$ is calculated}\DIFaddend . The residual is then used in conjunction with $r(t)$ to update the weights and the algorithm continues iteratively. \newline 

%https://citeseerx.ist.psu.edu/viewdoc/download;jsessionid=597B4CA0A9E3A810EF9E49A466A02ADC?doi=10.1.1.4.2748&rep=rep1&type=pdf for groing wndow
ARLS has three free parameters: the order parameter $M$, the forgetting factor $\lambda$, and the regularisation parameter $\delta$. Larger values of $M$ \DIFdelbegin \DIFdel{corresponds to an increased model}\DIFdelend \DIFaddbegin \DIFadd{increases the model's }\DIFaddend complexity. Whilst this generally increases the accuracy of the resulting estimates, it also increases the computational overhead and hence the latency between receiving the input data and updating the weights. In Sec.~\ref{sec:results} we trial a selection of $M$ values for synthetic GW data. Regarding the forgetting factor,  $\lambda=1$ corresponds to infinite memory, \DIFdelbegin \DIFdel{causing }\DIFdelend \DIFaddbegin \DIFadd{whereupon }\DIFaddend the filter becomes a \DIFdelbegin \DIFdel{"}\DIFdelend \DIFaddbegin \DIFadd{``}\DIFaddend growing window" RLS \citep{10.5555/547203,10.5555/560138}. In this work we use $\lambda=0.9999$ \DIFaddbegin \DIFadd{as a default}\DIFaddend . Different values of $\lambda$ are investigated in Section \ref{sec:roc2}. The regularisation parameter $\delta$ must be \DIFdelbegin \DIFdel{``suitably chosen " }\DIFdelend \DIFaddbegin \DIFadd{chosen judiciously to balance competing priorities  }\DIFaddend \citep{ljung1999system,1989system}. A large $\delta$ leads to rapid convergence of the ARLS algorithm, but with correspondingly larger variance in the parameter estimates before convergence. Conversely, a smaller $\delta$ leads to slower convergence and smaller variance in the parameter estimates. General guidelines for choosing $\delta$ are not readily available. Instead $\delta$ is typically \DIFdelbegin \DIFdel{empirically selected }\DIFdelend \DIFaddbegin \DIFadd{selected empirically }\DIFaddend for the particular problem. In this work we \DIFdelbegin \DIFdel{found }\DIFdelend \DIFaddbegin \DIFadd{find }\DIFaddend $\delta = 100$ to be a reasonable choice, \DIFdelbegin \DIFdel{since we have a large }\DIFdelend \DIFaddbegin \DIFadd{given the }\DIFaddend uncertainty in our initial estimate of the weights. We refer the reader to Chapter 9 of Ref.~\cite{HaykinAdaptiveFT:2002} for a full review of adaptive least squares estimation in the context of linear filtering. 
\begin{figure}
	\begin{center}
		\includegraphics[width=\columnwidth]{images/fir_block_2.pdf}
	\end{center}
	\caption{Block diagram of the ARLS method described in Section \ref{sec:ARLS}. The reference signal $r(t)$ is passed to an FIR filter to construct an estimate \DIFaddbeginFL \DIFaddFL{$\hat{c}(t)$ }\DIFaddendFL of the clutter. Subtracting $\hat{c}(t)$ from the primary signal $x(t)$ provides a residual $e(t)$ which controls the process to update to update the weights $\mathbf{w}$ of the FIR filter. The method proceeds iteratively. The diagonal line across the FIR filter block denotes that the parameters of the block (i.e. $\mathbf{w}$) are \DIFdelbeginFL \DIFdelFL{being }\DIFdelendFL updated, but are not part of the signal processed by the block.}
	\label{fig:arlsBlock}
\end{figure}

\section{Validation tests with an HMM} \label{sec:results}
We test the ANC scheme in Section \ref{sec:method} by combining it with a HMM to search for a CW signal with randomly wandering frequency, which overlaps the mains power line. Many other validation tests are possible, of course, and no individual test represents the final word on the efficacy of the scheme. Nonetheless, HMM-based searches are a key element of the data analysis program of the LVK Collaboration, generating a substantial corpus of published results \citep{LIGOMarkov17,LIGOMarkov19,PhysRevD.99.084042,2018PhRvD..97d3013S,LIGOMarkov22,2023PhRvD.107f4062V}. In the context of this paper, validations tests involving a HMM are especially powerful, because they present the ANC scheme with an additional challenge: to \DIFdelbegin \DIFdel{subtract the mains power line well enough to reveal }\DIFdelend \DIFaddbegin \DIFadd{detect }\DIFaddend an underlying CW signal, which is itself ``noisy'' (in the sense that its frequency wanders) rather than monochromatic. That is, the ANC-HMM combination is tasked to not only remove the stochastic 60-Hz interference but also distinguish it from the process noise in the CW signal's frequency. If the ANC succeeds in this complicated task, one may be confident that it also succeeds in the easier task of \DIFdelbegin \DIFdel{subtracting the mains power line to reveal }\DIFdelend \DIFaddbegin \DIFadd{detecting }\DIFaddend an underlying CW signal whose frequency is constant.  \newline 

In what follows, we employ the HMM scheme introduced by \citet{Suvorova2016PhRv}, which has been thoroughly tested through multiple LVK searches \cite{Piccinni2022,Riles2023,Wette2023}. We do not cover any details of the HMM scheme in this work and refer the reader to \citet{Suvorova2016PhRv} for further information. A synthetic CW signal $h(t)$, whose frequency executes an unbiased random walk, is injected into synthetic Gaussian noise $n(t)$ typical of the LIGO detectors. \DIFdelbegin \DIFdel{A }\DIFdelend \DIFaddbegin \DIFadd{Clutter $c(t)$ proportional to a }\DIFaddend simulated 60-Hz mains power line \DIFdelbegin \DIFdel{$c(t)$ }\DIFdelend is superposed, whose properties mimic the real \DIFdelbegin \DIFdel{system }\DIFdelend \DIFaddbegin \DIFadd{electrical supply }\DIFaddend (see Section \ref{sec22}). The challenge is to recover the $h(t)$ by passing the data $x(t)$ through the ANC filter and feeding the output into the HMM tracker. In Section \ref{sec:creating_data} we describe how we create a synthetic time series $x(t)$. In Section \ref{sec:representative_example} we present a representative example and compare the HMM's ability to detect and track $h(t)$ before and after applying ANC. 

\subsection{Synthetic data} \label{sec:creating_data}
In the tests that follow, we work with representative synthetic data, generated under controlled conditions, rather than directly with \DIFdelbegin \DIFdel{the }\DIFdelend LIGO data. We \DIFdelbegin \DIFdel{can }\DIFdelend generate synthetic data for the constituents of Equation \eqref{eq:data}\DIFdelbegin \DIFdel{- }\DIFdelend \DIFaddbegin \DIFadd{, }\DIFaddend namely $h(t)$, $c(t)$, and $n(t)$, by applying the recipe in Section \ref{sec21} as follows. \newline 

\DIFdelbegin \DIFdel{Starting with $h(t)$ we }\DIFdelend \DIFaddbegin \DIFadd{We }\DIFaddend assume that the source is isolated (i.e. not in a binary) and that the GW signal is quasimonochromatic (i.e. the frequency varies slowly over many wave cycles\DIFdelbegin \DIFdel{if at all}\DIFdelend ). We also place the source at a fixed sky position and neglect for simplicity the rotation and revolution of the Earth. The latter corrections are included readily in searches with real data through the maximum likelihood ${\cal F}$-statistic \citep{Jaranowski1998}. Under these assumptions the GW model reduces to 
\begin{equation}
	h(t) = h_0\sin[2\pi \phi_{\rm gw}(t)] \ , 
\end{equation}
where $h_0$ is the constant amplitude, $\phi_{\rm gw}(t)$ \DIFaddbegin \DIFadd{is }\DIFaddend a random phase,
\begin{equation}
	\phi_{\rm gw}(t) = \int_{0}^{t} ds \, f_{\rm gw}(s)  \ ,
\end{equation}
and the GW frequency $f_{\rm gw}(t)$ evolves stochastically and piecewise linearly from one time step to the next according to
\begin{eqnarray}
	f_{\rm gw}(t_{n+1}) = f_{\rm gw}(t_n) + \epsilon_n 
\end{eqnarray}
where $\epsilon_n$ is a zero-mean Gaussian random variable \DIFdelbegin \DIFdel{, }\DIFdelend with variance $\sigma_f^2$\DIFaddbegin \DIFadd{, }\DIFaddend viz.
\begin{equation}
	\epsilon_n = \mathcal{N}(0, \Delta t  \, \sigma_f^2) \ . \label{eq:gwfreqnoise}
\end{equation}
Hence the synthetic GW signal $h(t)$ is completely described by the parameters $h_0$, $\sigma_f$, and $f_{\rm gw}(t=0)$ \newline 

The clutter and reference signals evolve according to Equations \eqref{eq:voltage} and \eqref{eq:vclutter} respectively. For this initial study we take \DIFdelbegin \DIFdel{the amplitudes }\DIFdelend $A_r(t) = a_r$\DIFdelbegin \DIFdel{and }\DIFdelend \DIFaddbegin \DIFadd{, }\DIFaddend $A_c(t) = a_c$\DIFdelbegin \DIFdel{to be constants. Similarly, $P(t) = P=$ }\DIFdelend \DIFaddbegin \DIFadd{, and $P(t) = P$ to be }\DIFaddend constant. Different \DIFdelbegin \DIFdel{values for }\DIFdelend $P$ \DIFaddbegin \DIFadd{values }\DIFaddend are explored in Section \ref{sec:roc1}. Under these assumptions, Equations \eqref{eq:voltage} and \eqref{eq:vclutter} reduce to 
\begin{align}
 	r(t) = & a_r \cos \left[ 2 \pi f_{\rm ac} t +2 \pi \Delta f_{\rm ac} \cos\left(\frac{2 \pi t}{P}\right) + n_{\Theta} (t_n) \right] \nonumber \\ 
 	&+n_r(t_n) \ , \DIFaddbegin \\ 
	\DIFadd{c(t) = }& \DIFadd{a_c \cos }\biggl \{ \DIFadd{2 \pi f_{\rm ac} (t_n - \tau_{\rm delay}) }\nonumber \\ 
	&\DIFadd{+ 2 \pi \Delta f_{\rm ac} \cos }\biggl [ \DIFadd{\frac{2 \pi (t_n - \tau_{\rm delay)}}{P} }\biggr ] \nonumber \\ 
	&\DIFadd{+ n_{\Theta} (t_n - \tau_{\rm delay}) }\biggr \} \DIFadd{\ .
	}\label{eq:clutterequation}
\DIFaddend \end{align}
\DIFdelbegin \begin{align*}
	\DIFdel{c(t) = a_c \cos }&\DIFdel{\biggl \{ 2 \pi f_{\rm ac} (t_n - \tau_{\rm delay}) \nonumber }\\ 
	&\DIFdel{+ 2 \pi \Delta f_{\rm ac} \cos \biggl [ \frac{2 \pi (t_n - \tau_{\rm delay)}}{P} \biggr ] \nonumber }\\ 
	&\DIFdel{+ n_{\Theta} (t_n - \tau_{\rm delay}) \biggr \}
	%DIFDELCMD < \label{eq:clutterequation}%%%
}\end{align*}%DIFAUXCMD
\DIFdelend The synthetic reference and clutter data are fully described by the parameters \DIFdelbegin \DIFdel{$a_r,a_c,f_{\rm ac}, \Delta f_{\rm ac}, P,\sigma^2_{\Theta}$}\DIFdelend \DIFaddbegin \DIFadd{$a_r,a_c,P, f_{\rm ac}, \Delta f_{\rm ac},\sigma^2_{\Theta}$}\DIFaddend , $\sigma_r^2$. \newline 

The 11 free parameters are summarised in Table \ref{tab:parameterdescription1}, along with their chosen injected values. There are three amplitude parameters \DIFdelbegin \DIFdel{$h, a_r, a_c$, with $h \ll a_c, a_r$}\DIFdelend \DIFaddbegin \DIFadd{$h_0, a_r, a_c$, with $h \ll a_r, a_c$}\DIFaddend . There are four noise parameters \DIFdelbegin \DIFdel{$\sigma_n^2, \sigma_{\Theta}^2, \sigma_r^2$ and  $\sigma_f^2$}\DIFdelend \DIFaddbegin \DIFadd{$\sigma_n, \sigma_{\Theta}, \sigma_r$ and  $\sigma_f$}\DIFaddend . In this paper \DIFdelbegin \DIFdel{$\sigma_n^2$ and $\sigma_r^2$ }\DIFdelend \DIFaddbegin \DIFadd{$\sigma_n$ and $\sigma_r$ }\DIFaddend have fixed, constant values, whilst different values for \DIFdelbegin \DIFdel{$\sigma_f^2$ and $\sigma_{\Theta}^2$ }\DIFdelend \DIFaddbegin \DIFadd{$\sigma_f$ and $\sigma_{\Theta}$ }\DIFaddend are investigated in Section \ref{sec:representative_example} and Section \ref{sec:roc1} respectively. There are three additional parameters that specify the modulation of the central frequency: $f_{\rm ac}$, $\Delta f_{\rm ac}$ and $P$. In this paper $f_{\rm ac}$ is fixed at 60 Hz. Different values of $\Delta f_{\rm ac}$ and $P$ are investigated in Section \ref{sec:roc1}. Finally there is the initial \DIFdelbegin \DIFdel{G }\DIFdelend \DIFaddbegin \DIFadd{GW }\DIFaddend frequency, $f_{\rm gw}(t=0)$.
\begin{table*}

	\begin{tabular}{llcc}
		\hline 

%		 \multirow{2}{*}{Parameter} & \multirow{2}{*}{Physical meaning}  & \DIFdelbeginFL %DIFDELCMD < \multicolumn{2}{c}{Injected Value} %%%
%\DIFdelendFL \DIFaddbeginFL \multicolumn{2}{c}{Injected value} \DIFaddendFL \\
		\cline{3-4}
			 &  &Section \ref{sec:results} & Section \ref{sec:theroccurves}    \\
		\hline
		$h_0$  &    GW strain amplitude & 0.025& 0.022 \\ 
		$a_r$ & Mains voltage amplitude at PEM & $\mathcal{U}(10-0.01,10+0.01)$& $\mathcal{U}(10-0.01,10+0.01)$ \\
		$a_c$ & Interference voltage amplitude &$\mathcal{U}(1.2-0.001,1.2+0.001)$& $\mathcal{U}(1.2-0.001,1.2+0.001)$ \\
		\DIFdelbeginFL \DIFdelFL{$\sigma_n^2$ }\DIFdelendFL \DIFaddbeginFL \DIFaddFL{$\sigma_n$ }\DIFaddendFL & Strain channel measurement noise &1& 1 \\
		\DIFdelbeginFL \DIFdelFL{$\sigma_r^2$  }\DIFdelendFL \DIFaddbeginFL \DIFaddFL{$\sigma_r$  }\DIFaddendFL & PEM voltage measurement noise & \DIFdelbeginFL \DIFdelFL{$10^{-4}$}\DIFdelendFL \DIFaddbeginFL \DIFaddFL{$10^{-2}$}\DIFaddendFL &\DIFdelbeginFL \DIFdelFL{$10^{-4}$ }\DIFdelendFL \DIFaddbeginFL \DIFaddFL{$10^{-2}$ }\DIFaddendFL \\
		\DIFdelbeginFL \DIFdelFL{$\sigma_{\Theta}^2$ }\DIFdelendFL \DIFaddbeginFL \DIFaddFL{$\sigma_{\Theta}$ }\DIFaddendFL & PEM voltage phase noise  & \DIFdelbeginFL \DIFdelFL{$10^{-2}$}\DIFdelendFL \DIFaddbeginFL \DIFaddFL{$10^{-1}$}\DIFaddendFL & \DIFdelbeginFL \DIFdelFL{$\{ 10^{-3}, 10^{-2}, 10^{-1}\}$}\DIFdelendFL \DIFaddbeginFL \DIFaddFL{$\{ 10^{-3/2}, 10^{-1}, 10^{-1/2}\}$}\DIFaddendFL \\
		\DIFdelbeginFL \DIFdelFL{$\sigma^2_f$ }\DIFdelendFL \DIFaddbeginFL \DIFaddFL{$\sigma_f$ }\DIFaddendFL &  GW frequency noise & \DIFdelbeginFL \DIFdelFL{$\{0.01,0.1\}$}\DIFdelendFL \DIFaddbeginFL \DIFaddFL{$\{0.1,\sqrt{0.1}\}$ s$^{1/2}$}\DIFaddendFL & \DIFdelbeginFL \DIFdelFL{0.0016}\DIFdelendFL \DIFaddbeginFL \DIFaddFL{0.04 s$^{1/2}$}\DIFaddendFL \\
		$f_{\rm gw}(t=0)$ &  Initial GW frequency  & 59.5 Hz& 59.9 Hz\\
		$ f_{\rm ac}$ &  Central interference frequency & 60 Hz& 60 Hz\\ 
		$\Delta f_{\rm ac}$ &  Amplitude of interference frequency modulation  & 1 Hz& $\{0.5, 1.0, 1.5\}$ Hz\\
		$P$ & Period of interference frequency modulation & $10^2$ s& $\{ 10^{1}, 10^2, 10^3\}$ s \\
		\hline
	\DIFdelbeginFL %DIFDELCMD < 

%DIFDELCMD < 	%%%
\DIFdelendFL \end{tabular} 
	\DIFdelbeginFL %DIFDELCMD < 

%DIFDELCMD < 	%%%
\DIFdelendFL \caption{Parameters, their physical meaning, and the injected values used to generate synthetic data. The injected values are listed for validating the ANC scheme in Section \ref{sec:results}, and quantifying the performance of the scheme as a function of the properties of the mains power interference in Section  \ref{sec:theroccurves}. $a_r$ and $a_c$ are randomly drawn from separate uniform distributions\DIFdelbeginFL \DIFdelFL{. }\DIFdelendFL \DIFaddbeginFL \DIFaddFL{, denoted by $\mathcal{U}$ }\DIFaddendFL The braces notation (e.g. $\{0.01, 0.1\}$) indicates that multiple injected values \DIFdelbeginFL \DIFdelFL{have been }\DIFdelendFL \DIFaddbeginFL \DIFaddFL{are }\DIFaddendFL trialled. The quoted injected values \DIFdelbeginFL \DIFdelFL{have been }\DIFdelendFL \DIFaddbeginFL \DIFaddFL{of the three amplitude parameters and the four noise parameters and the are }\DIFaddendFL scaled such that \DIFdelbeginFL \DIFdelFL{$\sigma_n^2 = 1$}\DIFdelendFL \DIFaddbeginFL \DIFaddFL{$\sigma^2 = 1$}\DIFaddendFL .}
	\label{tab:parameterdescription1}
\end{table*}



\subsection{Representative worked examples} \label{sec:representative_example}
\begin{figure}
	\begin{center}
		\includegraphics[width=\columnwidth]{images/spectrum.png}
	\end{center}
	\caption{Spectrum (i.e.\ modulus of the Fourier transform) of the data $x(t)$ (orange curve), GW signal $h(t)$ (green curve) and decluttered output of the ANC filter $x(t) - \hat{c}(t)$ (blue curve) for a system with parameters described in Table \ref{tab:parameterdescription1}. ANC suppresses \DIFaddbeginFL \DIFaddFL{by $\approx 20\, {\rm dB}$ }\DIFaddendFL the orange spikes near $60 \, {\rm Hz}$, \DIFdelbeginFL \DIFdelFL{which }\DIFdelendFL corresponding to mains power interference\DIFdelbeginFL \DIFdelFL{, by $\approx 20\, {\rm dB}$.}\DIFdelendFL }
	\label{fig:spectrum}
\end{figure}
\begin{figure*}
	\begin{center}
			\includegraphics[width=\textwidth]{images/viterbi_tracking_canonical}
		\end{center}
	\caption{\label{frequency tracking before and after1}
			HMM tracking of a CW signal with spin wandering in the presence of $60 \, {\rm Hz}$ mains power interference before (left panel) and after (right panel) ANC. \DIFdelbeginFL \DIFdelFL{Colored }\DIFdelendFL \DIFaddbeginFL \DIFaddFL{Coloured }\DIFaddendFL contours (arbitrary units; see \DIFdelbeginFL \DIFdelFL{color }\DIFdelendFL \DIFaddbeginFL \DIFaddFL{colour }\DIFaddendFL bar at right) show the spectrogram of the data, i.e.\ the squared modulus of the Fourier transform of $x(t)$. The $60 \, {\rm Hz}$ line is visible as a vertical yellow band in the left panel; it cannot be discerned in the right panel. Injected signals: lower spin wandering, with $\sigma_f (N \Delta t)^{1/2} / f_{\rm ac} = 0.047$ (solid orange curve) \DIFdelbeginFL \DIFdelFL{, }\DIFdelendFL and \DIFaddbeginFL \DIFaddFL{$h_0 / \sigma_n = 0.025$, }\DIFaddendFL higher spin wandering, with $\sigma_f (N \Delta t)^{1/2} / f_{\rm ac} = 0.15$ (solid green curve) \DIFaddbeginFL \DIFaddFL{and $h_0 / \sigma_n = 0.025$}\DIFaddendFL .  \DIFdelbeginFL \DIFdelFL{In both cases $h_0 / \sigma_n^2 = 0.025$. }\DIFdelendFL Recovered signals: dashed white curves. Neither signal can be detected before ANC, so the dashed white curves \DIFdelbeginFL \DIFdelFL{appear }\DIFdelendFL \DIFaddbeginFL \DIFaddFL{are visible }\DIFaddendFL in the right panel only.}
\end{figure*}
To orient the reader, we start with two representative examples where the frequency wandering is  (i) `low', with $\sigma_f (N \Delta t)^{1/2} / f_{\rm ac} = 0.047$, and (ii) `high', with $\sigma_f (N \Delta t)^{1/2} / f_{\rm ac} = 0.15$. In both cases the effective \DIFdelbegin \DIFdel{SNR $h_0 / \sigma_n ^2= 0.025$}\DIFdelend \DIFaddbegin \DIFadd{signal-to-noise ratio equals $h_0 / \sigma_n = 0.025$}\DIFaddend . All other parameters are specified in Table \ref{tab:parameterdescription1}. For clarity of \DIFdelbegin \DIFdel{illustration}\DIFdelend \DIFaddbegin \DIFadd{exposition}\DIFaddend , we work with a single PEM in this section and extend to multiple PEMs in Section \ref{sec:roc2}\DIFaddbegin \DIFadd{. }\DIFaddend \newline 


We start by checking visually that the ANC filter removes most of the excess power from the 60 Hz interference. In Figure \ref{fig:spectrum} we plot the modulus of the Fourier \DIFdelbegin \DIFdel{transform }\DIFdelend \DIFaddbegin \DIFadd{transforms }\DIFaddend of the synthetic data $x(t)$, the underlying GW signal $h(t)$, and the decluttered output of the ANC filter, $e(t) = x(t) - \hat{c}(t)$, for Fourier frequencies from $58 \, {\rm Hz}$ to $62 \, {\rm Hz}$ for case (i). Before filtering, the spectrum of $x(t)$ has multiple \DIFdelbegin \DIFdel{modes about $f_{\rm ac} = 60 \, {\rm Hz}$}\DIFdelend \DIFaddbegin \DIFadd{peaks near $f = f_{\rm ac} = 60 \, {\rm Hz}$}\DIFaddend , visible as the orange spikes in Figure \ref{fig:spectrum}. After filtering, the spectrum of $e(t)$ is flatter, as indicated by the blue curve in Figure \ref{fig:spectrum}, with the exception of a clear feature at $59.5$ Hz coincident with the GW injection at $f_{\rm gw}(t=0)$ (green curve). In rough terms, the ANC scheme achieves $20 \, {\rm dB}$ of suppression in case (i). \DIFaddbegin \DIFadd{Similar results (not plotted) are obtained for case (ii). }\DIFaddend \newline 

Having established the ability of the ANC scheme to filter out $c(t)$ by calibrating against $r(t)$, we pass the ANC output to the HMM tracker and evaluate \DIFdelbegin \DIFdel{its }\DIFdelend \DIFaddbegin \DIFadd{the tracker's }\DIFaddend performance. The results are shown in  Figure \ref{frequency tracking before and after1} for both low and high frequency wandering, for a single realisation of the noise. The figure shows the spectrogram of $x(t)$ as a heat map before (left panel) and after (right panel) ANC filtering. It is clear that ANC suppresses the mains power interference, which is visible as a vertical yellow band in the left panel and is almost absent from the right panel. The spin wandering of the injected GW source (green solid curve for higher $\sigma_f$, orange solid curve for lower $\sigma_f$) and the HMM estimate (dashed white curves for both higher and lower $\sigma_f$) are superposed onto the spectrogram. The approximate overlap between the solid coloured and dashed white curves confirms that the ANC scheme and HMM tracker detect both injected signals successfully. For lower $\sigma_f$, the GW spin frequency wanders close to, but below, the 60 Hz interference line. For higher $\sigma_f$, the GW signal crosses the interference line, presenting a more difficult challenge, which is surmounted successfully nevertheless. The time-averaged root-mean-square error in the frequency estimate is $0.038$ Hz for low $\sigma_f $ and $0.47$ Hz for high $\sigma_f$. In contrast, neither the lower-$\sigma_f$ nor the higher-$\sigma_f$ injections are detected by the HMM tracker before ANC in the left panel \DIFaddbegin \DIFadd{(which is why there are no dashed white curves in the left panel)}\DIFaddend . 



\section{ROC curves}\label{sec:theroccurves}


%In Section \ref{sec:roc1} we quantify the performance of the ANC filter as a function of the properties of the mains power interference (e.g.\ $\Delta f_{\rm ac}$). In Section \ref{sec:roc2} we quantify the performance as a function of the ANC filter's settings, e.g. its order $M$ (i.e. the number of taps) and the number of PEM inputs.

In this section, we quantify the performance of the HMM tracker, when it analyzes filtered data supplied by the ANC scheme. We do so systematically by computing receiver operating characteristic (ROC) curves as a function of key parameters of the mains power interference (Section \ref{sec:roc1}) and ANC filter (Section \ref{sec:roc2}).

\subsection{Mains power interference parameters} \label{sec:roc1}

%\begin{figure}
%	\begin{center}
%			\includegraphics[width=\columnwidth]{images/4C_roccurve.png}
%		\end{center}
%	\caption{ROC curve over multiple noise realisations for different power line parameters. All other parameters are as specified in Table \ref{tab:parameterdescription2}. There is an evident high false alarm rate for all parameters, with a low AUC value of 0.55 for $\Delta f =0.0$, $\gamma=0.1$, and a high AUC value of 0.68 for $\Delta f =0.0$, $\gamma=0.001$. The high false alarm rate is a result of the interference not being completely removed by the ANC filter.}
%	\label{fig:roc1}
%\end{figure}


\begin{figure}
	\begin{center}
		\DIFdelbeginFL %DIFDELCMD < \includegraphics[width=\columnwidth]{images/roc_curve_mains_power_params}
%DIFDELCMD < 	%%%
\DIFdelendFL \DIFaddbeginFL \includegraphics[width=\columnwidth]{images/roc_curve_mains_power_params_log}
	\DIFaddendFL \end{center}
	\caption{Detection probability $p_{\rm d}$ as a function of false alarm probability $p_{\rm fa}$ (i.e. ROC \DIFdelbeginFL \DIFdelFL{curves}\DIFdelendFL \DIFaddbeginFL \DIFaddFL{curve}\DIFaddendFL ) for HMM tracking of a CW signal (\DIFdelbeginFL \DIFdelFL{$h_0 / \sigma_n^2 = 0.022$}\DIFdelendFL \DIFaddbeginFL \DIFaddFL{$h_0 / \sigma_n = 0.022$}\DIFaddendFL ) in conjunction with the ANC scheme, for different mains power interference parameters. The top\DIFdelbeginFL \DIFdelFL{panel shows different values of $\Delta f_{\rm ac}$}\DIFdelendFL , \DIFdelbeginFL \DIFdelFL{the }\DIFdelendFL middle \DIFdelbeginFL \DIFdelFL{panel }\DIFdelendFL \DIFaddbeginFL \DIFaddFL{and bottom panels display }\DIFaddendFL different values of \DIFaddbeginFL \DIFaddFL{$\Delta f_{\rm ac}$, }\DIFaddendFL $\sigma_{\Theta}^2$, and \DIFdelbeginFL \DIFdelFL{the bottom panel different values of }\DIFdelendFL $P$ \DIFaddbeginFL \DIFaddFL{respectively}\DIFaddendFL . The grey dashed \DIFdelbeginFL \DIFdelFL{line }\DIFdelendFL \DIFaddbeginFL \DIFaddFL{curve }\DIFaddendFL in all panels \DIFdelbeginFL \DIFdelFL{denotes }\DIFdelendFL \DIFaddbeginFL \DIFaddFL{corresponds to }\DIFaddendFL the performance of a random classifier. \DIFdelbeginFL \DIFdelFL{For }\DIFdelendFL \DIFaddbeginFL \DIFaddFL{In }\DIFaddendFL all panels the curves \DIFdelbeginFL \DIFdelFL{are broadly overlaid}\DIFdelendFL \DIFaddbeginFL \DIFaddFL{overlap approximately}\DIFaddendFL , illustrating that the \DIFaddbeginFL \DIFaddFL{performance of the }\DIFaddendFL HMM and ANC scheme is \DIFdelbeginFL \DIFdelFL{resilient }\DIFdelendFL \DIFaddbeginFL \DIFaddFL{insensitive }\DIFaddendFL to \DIFdelbeginFL \DIFdelFL{different }\DIFdelendFL \DIFaddbeginFL \DIFaddFL{the }\DIFaddendFL mains power parameters. At $p_{\rm fa} = 0.05$, the mean $p_{d}$ across the 3 curves is 0.52 (top panel), 0.48 (middle panel) and 0.58 (bottom panel).\DIFdelbeginFL \DIFdelFL{\textcolor{red}{TK: we could also label as e.g. $\Delta f_{\rm ac} / f_{\rm ac}$ as AM suggests. I personally find the absolute value with units more intuitive w.r.t the rest of the body text. Also: what do we think about having blue/green/orange curves in every panel?}}\DIFdelendFL }
	\label{fig:roc1}
\end{figure}
In this section we test how the ANC scheme and HMM tracker perform together as a function of the mains power parameters $\Delta f_{\rm ac}$, $\sigma_\Theta^2$ and $P$. To this end, we calculate the probability of detecting the CW signal, $p_{\rm d}$, as a function of the false alarm probability, $p_{\rm fa}$, i.e. the ROC curve $p_{\rm d} (p_{\rm fa})$. We consider three numerical experiments. In the first experiment we vary $\Delta f_{\rm ac} =  \{0.5, 1.0, 1.5\}$ Hz whilst holding constant $\sigma_{\Theta}^2 = 10^{-2}$ and $P = 100 $ s. In the second experiment we vary $\sigma_{\Theta}^2 =  \{ 10^{-3}, 10^{-2}, 10^{-1}\}$ whilst holding constant $\Delta f_{\rm ac} = 1.0$ Hz and $P = 100 $ s. In the third experiment we vary $P=  \{ 10, 10^2, 10^3\}$ s whilst holding constant $\Delta f_{\rm ac} = 1.0$ Hz and $\sigma_{\Theta}^2 = 10^{-2}$. For all experiments \DIFdelbegin \DIFdel{$h_0 / \sigma_n^2 = 0.022$, $f_{\rm gw}(t=0)$ is fixed to 59.9 }\DIFdelend \DIFaddbegin \DIFadd{we fix $h_0 / \sigma_n = 0.022$, $f_{\rm gw}(t=0) = 59.9$ }\DIFaddend Hz, and $N \Delta t = 800$ s. \DIFdelbegin \DIFdel{Note that despite }\DIFdelend \DIFaddbegin \DIFadd{Despite }\DIFaddend expecting $\Delta f_{\rm ac} < 0.5$ \DIFaddbegin \DIFadd{in practice}\DIFaddend , as discussed in Section \ref{sec21}, \DIFdelbegin \DIFdel{in this Section }\DIFdelend we trial larger values of $\Delta f_{\rm ac}$ in order to \DIFdelbegin \DIFdel{provide }\DIFdelend \DIFaddbegin \DIFadd{set }\DIFaddend a more difficult test for the ANC scheme and HMM tracker. All \DIFdelbegin \DIFdel{other }\DIFdelend \DIFaddbegin \DIFadd{injected }\DIFaddend parameters are specified in Table \ref{tab:parameterdescription1}. \newline 


Figure \ref{fig:roc1} displays the ROC curves resulting from the three numerical experiments above \DIFdelbegin \DIFdel{. In }\DIFdelend \DIFaddbegin \DIFadd{in the top, middle and bottom panels respectively. For example in }\DIFaddend the top panel the results of the first experiment are plotted, where we set  $\Delta f_{\rm ac} = \{0.5, 1.0, 1.5\}$ Hz (blue, green and orange curves respectively). Also plotted for comparison is the performance of a random classifier (grey dashed \DIFdelbegin \DIFdel{diagonal line}\DIFdelend \DIFaddbegin \DIFadd{curve}\DIFaddend ). The performance across different $\Delta f_{\rm ac}$\DIFaddbegin \DIFadd{, $\sigma_\Theta$, and $P$ }\DIFaddend values is broadly comparable, with the ROC curves \DIFdelbegin \DIFdel{generally overlaid. For all values of $\Delta f_{\rm ac}$ the ANC scheme and HMM tracker outperform }\DIFdelend \DIFaddbegin \DIFadd{overlapping approximately and outperforming }\DIFaddend a random classifier (i.e. each of the ROC curves lies above the grey dashed line). \DIFaddbegin \newline 


\DIFaddend We take $p_{d}(p_{\rm fa} =0.05)$ as a scalar metric to quantify the \DIFaddbegin \DIFadd{typical }\DIFaddend performance of the HMM-ANC combination \DIFdelbegin \DIFdel{. For }\DIFdelend \DIFaddbegin \DIFadd{in practical applications. In }\DIFaddend the top panel \DIFaddbegin \DIFadd{we obtain }\DIFaddend $p_{\rm d}(0.05$) = \DIFdelbegin \DIFdel{$(0.5, 0.5, 0.57)$ }\DIFdelend \DIFaddbegin \DIFadd{$ \{0.50, 0.50, 0.57 \}$ }\DIFaddend for $\Delta f_{\rm ac} =  \{0.5, 1.0, 1.5\}$ Hz respectively. In the middle panel \DIFdelbegin \DIFdel{the results of the second experiment are plotted, where we set  $\sigma_{\Theta}^2 =  \{ 10^{-3}, 10^{-2}, 10^{-1}\}$  (blue, green and orange curves respectively). Again the ANC scheme and HMM tracker outperform a random classifier, and the results are broadly consistent across different parameter values, with }\DIFdelend \DIFaddbegin \DIFadd{we obtain }\DIFaddend $p_{\rm d}(0.05$) = \DIFdelbegin \DIFdel{$(0.44,0.50,0.49)$ }\DIFdelend \DIFaddbegin \DIFadd{$ \{0.44,0.50,0.49 \}$ }\DIFaddend for $\sigma_{\Theta}^2 =  \{ 10^{-3}, 10^{-2}, 10^{-1}\}$ respectively. In the bottom panel \DIFdelbegin \DIFdel{the results of the third experiment are plotted where we set $P=  \{ 10, 10^2, 10^3\}$ s (blue, green and orange curves respectively). Once again the scheme outperforms a random classifier and is robust to different parameter values, with }\DIFdelend \DIFaddbegin \DIFadd{we obtain }\DIFaddend $p_{\rm d}(0.05) = (0.7,0.49,0.54)$ for $P=  \{ 10, 10^2, 10^3\}$ s respectively.


\subsection{\DIFdelbegin \DIFdel{Filter }\DIFdelend \DIFaddbegin \DIFadd{ANC filter }\DIFaddend parameters} \label{sec:roc2}
\begin{figure}
	\begin{center}
		\DIFdelbeginFL %DIFDELCMD < \includegraphics[width=\columnwidth]{images/roc_curve_filter_params}
%DIFDELCMD < 	%%%
\DIFdelendFL \DIFaddbeginFL \includegraphics[width=\columnwidth]{images/roc_curve_filter_params_log}
	\DIFaddendFL \end{center}
	\caption{\DIFdelbeginFL \DIFdelFL{ROC curves $p_{\rm d} (p_{\rm fa})$ }\DIFdelendFL \DIFaddbeginFL \DIFaddFL{As Figure \ref{fig:roc1} but }\DIFaddendFL for \DIFdelbeginFL \DIFdelFL{the HMM/ANC tracking of a CW signal for }\DIFdelendFL different ANC filter parameters. The top\DIFdelbeginFL \DIFdelFL{panel displays }\DIFdelendFL \DIFaddbeginFL \DIFaddFL{, middle and bottom panels display }\DIFaddendFL the ROC curves for different \DIFdelbeginFL \DIFdelFL{number }\DIFdelendFL \DIFaddbeginFL \DIFaddFL{numbers }\DIFaddendFL of PEM reference channels, $N_{\rm ref}$, \DIFdelbeginFL \DIFdelFL{the middle panel different values of }\DIFdelendFL \DIFaddbeginFL \DIFaddFL{tap weights }\DIFaddendFL $M$\DIFaddbeginFL \DIFaddFL{, }\DIFaddendFL and \DIFdelbeginFL \DIFdelFL{the bottom panel different values of }\DIFdelendFL \DIFaddbeginFL \DIFaddFL{forgetting factors }\DIFaddendFL $\lambda$ \DIFaddbeginFL \DIFaddFL{respectively}\DIFaddendFL . All panels additionally include the ROC curve for a random classifier (i.e. the lower performance limit, \DIFdelbeginFL \DIFdelFL{diagonal }\DIFdelendFL grey dashed line) and the \DIFdelbeginFL \DIFdelFL{ROC curve for the case where there is }\DIFdelendFL zero interference \DIFaddbeginFL \DIFaddFL{ROC curve }\DIFaddendFL (i.e. the upper performance limit, grey dotted \DIFdelbeginFL \DIFdelFL{line}\DIFdelendFL \DIFaddbeginFL \DIFaddFL{curve}\DIFaddendFL ).}
	\label{fig:roc2}
\end{figure}
We \DIFdelbegin \DIFdel{have shown }\DIFdelend \DIFaddbegin \DIFadd{verified }\DIFaddend in Section \ref{sec:roc1} \DIFdelbegin \DIFdel{how }\DIFdelend \DIFaddbegin \DIFadd{that }\DIFaddend the ANC scheme and HMM tracker are \DIFdelbegin \DIFdel{robust to different parameters of }\DIFdelend \DIFaddbegin \DIFadd{insensitive to }\DIFaddend the mains power interference \DIFaddbegin \DIFadd{parameters}\DIFaddend . In this section we investigate \DIFdelbegin \DIFdel{different }\DIFdelend \DIFaddbegin \DIFadd{the performance as a function of the control }\DIFaddend parameters of the ANC \DIFdelbegin \DIFdel{scheme }\DIFdelend \DIFaddbegin \DIFadd{filter }\DIFaddend itself. Specifically, we investigate three important questions:
\begin{enumerate}
	\item How does ANC benefit from multiple independent references?
	\item What order ANC filter ($M$) is required to achieve good interference cancellation? 
	\item How does ANC performance depend on $\lambda$?
\end{enumerate} 
\DIFdelbegin \DIFdel{Regarding the first question, the preceding validation tests on synthetic data all assumed that we have }\DIFdelend \DIFaddbegin 


\DIFadd{Figure \ref{fig:roc2} displays the ROC curves for different values of the number of PEM references ($N_{\rm ref}$, top panel), $M$ (middle panel) and $\lambda$ (bottom panel). All mains power interference parameters are as specified in Table \ref{tab:parameterdescription1}. Also plotted for comparison in every panel is the ROC curve of a random classifier (grey dashed diagonal line) and the ROC curve for $c(t) = 0$ (grey dotted line). The zero interference case is included as a performance upper bound. The validation tests in Sections \ref{sec:representative_example} and \ref{sec:roc1} assume }\DIFaddend a single PEM reference voltage\DIFdelbegin \DIFdel{measurement. However}\DIFdelend \DIFaddbegin \DIFadd{. In practice}\DIFaddend , as discussed in Section \ref{sec23}\DIFdelbegin \DIFdel{in practice }\DIFdelend \DIFaddbegin \DIFadd{, }\DIFaddend there are multiple PEM channels measuring power line interference for LIGO (c.f. Figure \ref{coherenceplot_1}). Specifically, for O3 there are \DIFdelbegin \DIFdel{9 }\DIFdelend \DIFaddbegin \DIFadd{nine }\DIFaddend PEM channels which directly measure the \DIFdelbegin \DIFdel{mains voltage }\DIFdelend \DIFaddbegin \DIFadd{three-phase voltages }\DIFaddend at each of the LIGO-Livingston and LIGO-Hanford sites. Multiple PEM channels provided additional independent \DIFdelbegin \DIFdel{measurements of the reference voltage; it seems reasonable to suspect that these additional channels may aid the }\DIFdelend \DIFaddbegin \DIFadd{references, which should improve the }\DIFaddend performance of the ANC filter. Indeed, ANC is commonly used with multiple reference signals in other electrical engineering applications such as noise cancelling headphones \citep{10.1121/1.5109394}, communication intelligibility \citep{KUO1996669,doi:10.1177/1084713812456906} and cardiac monitoring \citep{7755741}. \DIFdelbegin \DIFdel{For the second question, the order of the filter, i.e. the number of taps, is a parameter that can be freely chosen in ARLS. Generally an increased number of taps is expected to improve the performance of the filter due to the increased model complexity. However, this comes at an increased computational cost and also an increased latency. For real time applications tracking the wandering of the GW frequency it is important to minimize both of these variables. In this work we explicitly specify the number of taps; we note that adaptive tap length methods are also available \mbox{%DIFAUXCMD
\citep[e.g.][]{1326385,KAR2017422,KAR2020107043}}\hskip0pt%DIFAUXCMD
. Regarding the third question, the use of the forgetting factor $\lambda$ allows ARLS to handle non-stationary systems, neglecting older data in favour of more recent data. This is useful for cases where the model parameters are time-varying, enabling more rapid convergence and effective tracking. In the case when $\lambda = 1$, ARLS has infinite memory and so exhibits good stability and low misadjustment. However the tracking capability can be reduced for non-stationary systems. Conversely, $\lambda < 1$ improves the tracking at the expense of reduced stability and increased misadjustment \mbox{%DIFAUXCMD
\citep{Ciochina5206117}}\hskip0pt%DIFAUXCMD
. In this paper we run ARLS using a specific value for $\lambda$, but note that adaptive $\lambda$ algorithms are also available \mbox{%DIFAUXCMD
\citep{app12042077,1468506,4639569}}\hskip0pt%DIFAUXCMD
. }%DIFDELCMD < \newline 
%DIFDELCMD < 

%DIFDELCMD < %%%
\DIFdel{Figure \ref{fig:roc2} displays the ROC curves for different values of the number of PEM references ($N_{\rm ref}$, top panel), $M$ (middle panel) and $\lambda$ (bottom panel). All mains power interference parameters are as specified in Table \ref{tab:parameterdescription1}. Also plotted for comparison in every panel is the ROC curve of a random classifier (grey dashed diagonal line) and the ROC curve when $c(t) = 0$ (grey dotted line). The zero interference case is included to provide a reference on the performance upper limit. }%DIFDELCMD < \newline 
%DIFDELCMD < 

%DIFDELCMD < %%%
\DIFdel{The top panel }\DIFdelend \DIFaddbegin \DIFadd{Indeed an improvement of this kind is visible in the top pane of Figure \ref{fig:roc2} which }\DIFaddend plots the ROC curves for $N_{\rm ref} = \{ 1,2,9 \}$ (blue, green and orange curves respectively). The detection probability $p_{\rm pd} (0.05) = \{ 0.38,0.52,0.55 \}$ for each of the respective $N_{\rm ref}$. For comparison, in the zero interference case $p_{\rm pd}(0.05) = 0.85$. It is evident that $N_{\rm ref} > 1$ are generally an improvement over $N_{\rm ref} = 1$. However, the improvement of $N_{\rm ref} =9$ over $N_{\rm ref} =2$ is more modest. This suggests that the inclusion of additional reference PEM channels \DIFdelbegin \DIFdel{quickly }\DIFdelend reaches a point of diminishing returns\DIFdelbegin \DIFdel{where the interference is well-captured by a few reference channels, and adding more references beyond this point does not improve the effectiveness }\DIFdelend \DIFaddbegin \DIFadd{. }\newline 


\DIFadd{With respect to the second question concerning the order of the filter, more taps should improve the performance }\DIFaddend of the filter \DIFdelbegin \DIFdel{. The middle panel plots }\DIFdelend \DIFaddbegin \DIFadd{due to the increased model complexity. Indeed, this trend is observed in the middle panel of Figure \ref{fig:roc2}  which plots ROC curves for }\DIFaddend $M = \{10,15,30\}$ (blue, green, and orange curves respectively). The detection probability $p_{\rm pd} (0.05) = \{0.37, 0.57, 0.58\}$ for each respective $M$. Analogous to the top panel, increasing $M$ generally increases the detection probability, but the performance \DIFdelbegin \DIFdel{quickly saturatessuch that }\DIFdelend \DIFaddbegin \DIFadd{saturates; }\DIFaddend the ROC curves for $M=15$ and $M=30$ are \DIFdelbegin \DIFdel{highly comparable. In the bottom panel we plot }\DIFdelend \DIFaddbegin \DIFadd{comparable. More taps increases the computational costs and latency (i.e. the delay in the signal processing pipeline due to the filter). In this work we explicitly specify the number of taps, while noting that adaptive tap length methods are also available \mbox{%DIFAUXCMD
\citep[e.g.][]{1326385,KAR2017422,KAR2020107043}}\hskip0pt%DIFAUXCMD
. }\newline 


\DIFadd{With respect to the third question concerning the forgetting factor $\lambda$, we find that $p_{\rm d}$ is a strong function of $\lambda$ at fixed $p_{\rm fa}$. In the bottom panel of Figure \ref{fig:roc2}, we plot ROC curves for }\DIFaddend $\lambda = \{1,2,9\}$ (blue, green, orange curves respectively), which have \DIFdelbegin \DIFdel{respective }\DIFdelend $p_{\rm pd} (0.05) = \{0.38, 0.52, 0.55\}$ \DIFaddbegin \DIFadd{respectively}\DIFaddend . A clear hierarchy is evident whereby larger values of $\lambda$ increase the detection probability. For the synthetic data in this paper $\lambda=1$ is advantageous for detection since the interference is quasi-stationary (c.f. Equation \ref{eq:clutterequation}). Consequently, discounting older data with $\lambda < 1$ inhibits the ability of the ANC scheme to filter out the interference. We defer investigation of non-stationary interference (c.f. Equation \ref{eq:vclutter}) to \DIFdelbegin \DIFdel{a }\DIFdelend future work. \DIFdelbegin \DIFdel{For application to }\DIFdelend \DIFaddbegin \DIFadd{When analysing }\DIFaddend real astrophysical data $\lambda$ \DIFdelbegin \DIFdel{will need to }\DIFdelend \DIFaddbegin \DIFadd{should }\DIFaddend be selected optimally\DIFdelbegin \DIFdel{e.g. \mbox{%DIFAUXCMD
\citep{6349749}}\hskip0pt%DIFAUXCMD
. }\DIFdelend \DIFaddbegin \DIFadd{. Algorithms exist to achieve this, as in Ref. \mbox{%DIFAUXCMD
\citep{6349749}}\hskip0pt%DIFAUXCMD
. In general one reduces $\lambda=1$, neglecting older data in favour of more recent data, to handle non-stationary systems. This is useful for cases where the model parameters are time-varying, enabling more rapid convergence and effective tracking. For $\lambda = 1$, ARLS has infinite memory and so exhibits good stability (i.e. insensitivity to numerical perturbations) and low misadjustment (i.e. $\mathbf{w}$ is not erroneously updated away from its optimal value $\mathbf{w}_{\rm opt}$). Conversely, $\lambda < 1$ improves the tracking at the expense of reduced stability and increased misadjustment \mbox{%DIFAUXCMD
\citep{Ciochina5206117}}\hskip0pt%DIFAUXCMD
. In this paper we run ARLS using a specific value for $\lambda$, but note that adaptive $\lambda$ algorithms are also available \mbox{%DIFAUXCMD
\citep{app12042077,1468506,4639569}}\hskip0pt%DIFAUXCMD
. }\newline 
\DIFaddend 




%DIF < \begin{figure}
%DIF < 	\begin{center}
%DIF < 		\includegraphics[width=\columnwidth]{images/taps_vs_error}
%DIF < 	\end{center}
%DIF < 	\caption{Mean square error (MSE) in the Viterbi estimates of the GW wandering spin frequency for a system with $h=0.025$ and $\Delta f =0.0$ relative to the number of taps used in the FIR filter. Up to three PEM reference channels are used. The solution for the case with zero interference clutter is also shown.}
%DIF < 	\label{fig:filterorder2}
%DIF < \end{figure}
\DIFdelbegin %DIFDELCMD < 

%DIFDELCMD < %%%
%DIF < We have shown that the ANC filter used in conjunction with the Viterbi algorithm is effective at tracking the wandering GW spin frequency, but suffers from a high false alarm rate for the particular parameters of the ANC filter that we have been using. 
%DIF < 
%DIF < 
%DIF < 
%DIF < 
%DIF < 
%DIF < 
%DIF < 
%DIF < 
%DIF < 
%DIF < 
%DIF < The results are presented in Figure \ref{fig:roc2}
%DIF < 
%DIF < 
%DIF < 
%DIF < 
%DIF < 
%DIF < 
%DIFDELCMD < 

%DIFDELCMD < %%%
%DIF < In Figure \ref{fig:4C_roccurve_multi_ref} we present the ROC curves for 3 different example systems:
%DIF < \begin{itemize}
%DIF < 	\item \textbf{System A}. $\gamma = 10^{-3} \, , \Delta f = 0.0$. Dashed lines in the figure.
%DIF < 	\item \textbf{System B}. $\gamma = 10^{-2} \, , \Delta f = 0.0$. Dash-dotted in the figure
%DIF < 	\item \textbf{System C}. $\gamma = 10^{-2} \, , \Delta f = 0.5$. Solid lines in the figure
%DIF < \end{itemize}
%DIF < For each system we compute the ROC curve over \textbf{multiple noise realisations} for both one and two reference channels (blue, and orange lines respectively). This gives us six total ROC curve solutions. For comparison we also plot the case where we run the Viterbi search for one of the example systems, but with zero PEM references (dotted green line). The specific AUC values for each ROC curve are reported in Table \ref{tab:AUC}. \newline 
%DIFDELCMD < 

%DIFDELCMD < %%%
%DIF < We can see that for all example systems the detection probability is high with respect to the false alarm probability. The detection probability using ANC filtering is greater than without ANC filtering for all systems (i.e. the orange and blue lines are exclusively above the green dotted line). Specifically the for the zero filtering case AUC$=0.54$, whilst all cases which use ANC filtering have AUC$\ge 0.82$ and as high as AUC$=0.99$. The inclusion of an additional reference channel improves the detection probability for Systems A and C, with the AUC values rising from 0.975 to 0.990 for System A and from $0.987$ to $0.999$ for System B. No improvement is observed for System B, with AUC$=0.827$ for $N_{\rm ref} =1$ and AUC$=0.822$ for $N_{\rm ref} =2$. The lack of improvement for System B when using two PEM references suggests that for these parameters a single reference is sufficient to capture the dynamics of the interference clutter. \newline  \footnote{\tiny \textcolor{red}{TK: Why are these results so different to Figure 8? Has the strain amplitude changed? Need to check with Sofia}\normalsize}
%DIFDELCMD < 

%DIFDELCMD < %%%
%DIF < 
%DIF < Figure  \ref{fig:filterorder2} we plot the mean squared error (MSE) in the GW frequency estimated by Viterbi compared to the true spin-wandering frequency, averaged over \textbf{multiple noise realisations}. We set the system to have $h=0.025$ and $\Delta f =0.0$ and consider up to three PEM reference channels. As a reference we also plot the error in the Viterbi estimates for the case where there is no interference clutter and so no ANC is required. We can see that generally the accuracy improves with an increased number of taps. When $M$ is small the $N_{\rm ref} =1$ solution generally outperforms the high $N_{\rm ref}$ solutions; in this regime the number of taps is sufficiently small to not be able to take advantage of the increased information provided by the additional reference channels. Conversely as the number of taps increases, the $N_{\rm ref} =3$ becomes the best performing solution. 
%DIF < 
%DIFDELCMD < 

%DIFDELCMD < %%%
%DIF < \begin{equation}
%DIF < 	{\rm MSE}=E_{\rm emp} \left [(\sum_{i=0}^{KN}e_i^2)/(KN+1) \right ]
%DIF < \end{equation}
%DIF < where we use $E_{\rm emp} [X]$ to denote the empirical mean of a quantity $X$ over 500 simulations. \textcolor{red}{TK: confirm this equations is correct and what are K/N in the updated notation?}. The MSE as a function of the number of taps $M$ is shown in Fig \ref{mse vs tap} for a system with $|H(w)|=3$ and $\rm{SNR}_{\rm in}=0.02$. We can see that initially as the number of taps increases from the MSE deceases, finidng a minimum at around $M=64$. This is due to the narrower bandwidth enabling a sharper filter to remove more of the interference. Beyond this point the MSE starts to increase. Now the increased sharpness of the filter is hampered by the time delay from using too many taps and the filter is not able to track the frequency with a sufficiently small latency. 
%DIFDELCMD < 

%DIFDELCMD < %%%
%DIF < With the performance of the ANC and Viterbi approach established for a single example, it is of interest to explore how the algorithm performs for different power line parameters. In this section we vary $\Delta f$ and $\gamma$ to test the ANC and Viterbi performance for multiple noise realisations. To this end we calculate the detection probability compared to the false alarm probability, i.e. the receiver operating characteristic (ROC), for the Viterbi search after ANC. 
%DIF < 
%DIF < 
%DIF < In this paper we address two important questions 
%DIF < 
%DIF < 
%DIF < We investigate this by computing the 
%DIF < mean square difference between the signal after applying the ANC with the signal without interference as function of the order. 
%DIFDELCMD < 

%DIFDELCMD < %%%
%DIF < \begin{figure}
%DIF < 	\begin{center}
%DIF < 		\includegraphics[width=\columnwidth]{images/filter_order.png}
%DIF < 	\end{center}
%DIF < 	\caption{\textcolor{red}{TK: filter order. From filter\_order\_experiments.mat. Maybe we should update this for an MSE after Viterbi?}}
%DIF < 	\label{fig:filterorder}
%DIF < \end{figure}
%DIFDELCMD < 

%DIFDELCMD < %%%
%DIF < \begin{figure}
%DIF < 	\begin{center}
%DIF < 		\includegraphics[width=\columnwidth]{images/roc_final_stacked.png}
%DIF < 	\end{center}
%DIF < 	\caption{ROC curve for 3 different systems $\{ \gamma = 0.001, \Delta f = 0.0\}$, $\{ \gamma = 0.01, \Delta f = 0.0\}$ , $\{ \gamma = 0.01, \Delta f = 0.5\}$ (dotted, dashed, solid respectively). The green lines denote the Viterbi search run without any ANC filtering, the blue lines with ANC filtering with 1 reference channel and the orange line with 2 reference channels. ANC filtering using 2 reference channels consistently outperforms that using a single reference channel.}
%DIF < 	\label{fig:roc3}
%DIF < \end{figure}
%DIFDELCMD < 

%DIFDELCMD < %%%
%DIF < As discussed the ARLS filter has 2 parameters that can be freely chosen, the forgetting factor $\lambda$ and the model order (i.e. the number of taps in the FIR filter), $M$. For this work we have set $\lambda$ to a fixed value of $\lambda = 0.9999$. 
%DIFDELCMD < 

%DIFDELCMD < %%%
%DIF < 
%DIF < 
%DIF < 
%DIFDELCMD < 

%DIFDELCMD < %%%
%DIF < \textcolor{red}{Changrong:} If we simply add more reference signals without normalizing the amplitude, it will definitely result in better performance (this is like we increase $|H(w)|$). But if we normalize the amplitude $a_r$ by $a_r/L$ with $L$ the number of references, we will not see obvious improvement.
%DIF < 
%DIF < It might be the overfitting problem Rob mentioned previously, where with the number of taps chosen sufficiently large, it might already be enough to capture the dynamics of the interference signal without adding new interferences.
%DIF < 
%DIF < But if we have multiple independent interference sources, with each reference correlated to each interference, then I suppose we should add more references.
%DIF < 
%DIF < 
%DIFDELCMD < 

%DIFDELCMD < %%%
\DIFdelend \section{Conclusions}\label{sec:conclusions}
In this paper we demonstrate a new line subtraction method based on \DIFdelbegin \DIFdel{adaptive noise cancellation }\DIFdelend \DIFaddbegin \DIFadd{ANC }\DIFaddend for use in continuous gravitational wave searches. We use an \DIFdelbegin \DIFdel{adaptive recursive least squares }\DIFdelend \DIFaddbegin \DIFadd{ARLS }\DIFaddend method in conjunction with an independent, known PEM reference signal to suppress the interference from a long-lived narrow spectral feature. We then search for the continuous wave signal\DIFdelbegin \DIFdel{using a HMM Viterbi algorithm}\DIFdelend \DIFaddbegin \DIFadd{, whose frequency wanders stochastically in general, using a standard HMM search pipeline}\DIFaddend . We test \DIFdelbegin \DIFdel{our method }\DIFdelend \DIFaddbegin \DIFadd{the scheme }\DIFaddend on synthetic data \DIFdelbegin \DIFdel{containing }\DIFdelend \DIFaddbegin \DIFadd{modelling }\DIFaddend the 60 Hz \DIFdelbegin \DIFdel{spectral interference line due to }\DIFdelend \DIFaddbegin \DIFadd{interference from }\DIFaddend the North American \DIFdelbegin \DIFdel{power grid. 
We show how the the ANC and Viterbi algorithm together are able to successfully track the spin-wandering continuous GW signal near the 60 Hz line. The method is shown to be robust }\DIFdelend \DIFaddbegin \DIFadd{mains power supply. 
}

\DIFadd{We find that ANC suppresses the 60-Hz interference by approximately 20 dB, allowing the HMM to track continuous-wave signals that overlap with the 60-Hz spectral feature. Quantitatively, we find the method }\DIFaddend to \DIFaddbegin \DIFadd{be insensitive to }\DIFaddend different mains power interference parameters, \DIFdelbegin \DIFdel{whilst larger values of }\DIFdelend \DIFaddbegin \DIFadd{with $p_{\rm d}(0.05) \sim 0.5$ across a range of values. The method is dependent on the filter parameters }\DIFaddend $N_{\rm ref}$, $M$ and $\lambda$\DIFdelbegin \DIFdel{generally increase the effectiveness of }\DIFdelend \DIFaddbegin \DIFadd{. The detection probability $p_{\rm d}(0.05)$ generally increases at larger values of these parameters, albeit at a decreasing rate. Specifically, $p_{\rm d}(0.05) = \{0.55, 0.58,0.55\}$ for $N_{\rm ref} = 9$, $M=30$ and $\lambda=1$ respectively. }\newline 

\DIFadd{Ref. \mbox{%DIFAUXCMD
\cite{CovasEtAl:2018} }\hskip0pt%DIFAUXCMD
catalogues long-lived, narrowband interference in the LIGO interferometers from various sources, including electrical subsystems, mechanical subsystems and calibration processes. Some of these instrumental lines are ``cleaner'' spectrally than mains power interference, while others are not. In the future, it will be interesting to test whether the success achieved by the ANC scheme in this paper extends to other instrumental lines. Such tests involve investment in human and computational resources but, if successful, will increase the proportion of }\DIFaddend the \DIFdelbegin \DIFdel{ANC filter and the probability of detecting the GW signal}\DIFdelend \DIFaddbegin \DIFadd{LIGO band accessible to continuous wave searches at frequencies of astrophysical interest, especially at $\lesssim 0.1 \, {\rm kHz}$}\DIFaddend .



%DIF < This is a conclusion 
\DIFdelbegin %DIFDELCMD < 

%DIFDELCMD < %%%
%DIF < \appendix
%DIF < \subfile{anc-app}
%DIF < \label{app:failedMs}
%DIFDELCMD < 

%DIFDELCMD < \newpage 
%DIFDELCMD < \newpage 
%DIFDELCMD < 

%DIFDELCMD < \appendix
%DIFDELCMD < 

%DIFDELCMD < %%%
%DIF < \begin{figure}[h!]
%DIF < 	\begin{center}
%DIF < 		\includegraphics[width=0.49\textwidth]{result_images/mse_tap.pdf}
%DIF < 	\end{center}
%DIF < 	\caption{\label{mse vs tap}
%DIF < 		Mean square error: MSE as a function of number of taps with $|H(w)|=3$ and $\rm{SNR}_{\rm in}=0.02$.}
%DIF < \end{figure}
%DIFDELCMD < 

%DIFDELCMD < %%%
%DIF < 
%DIF < \begin{figure*}
%DIF < 	\begin{center}
%DIF < 		\includegraphics[width=\textwidth]{images/ANC_shared_y_example_1_high_contrast}
%DIF < 	\end{center}
%DIF < 	\caption{\label{frequency tracking before and after1high}
%DIF < 		Tracking of the frequency evolution of a continuous GW with SNR$_{\rm in} = 0.025$, $H(\omega) =4$ and $\Delta f = 0.5$ using a HMM Viterbi algorithm both before (left hand panel) and after (right hand panel) the application of the ANC filter to remove the interference signal centred at 60Hz. The GW signal is indicated by diagonal dashed line. \textcolor{red}{TK: high contrast version also available. What are the settings?}}
%DIF < \end{figure*}
%DIF < 
%DIF < 
%DIF < 
%DIF < \begin{figure*}
%DIF < 	\begin{center}
%DIF < 		\includegraphics[width=\textwidth]{images/ANC_shared_y_example_2_high_contrast}
%DIF < 	\end{center}
%DIF < 	\caption{\label{frequency tracking before and after2high}
%DIF < 		Tracking of the frequency evolution of a continuous GW with SNR$_{\rm in} = 0.025$, $H(\omega) =4$ and $\Delta f = 0.5$ using a HMM Viterbi algorithm both before (left hand panel) and after (right hand panel) the application of the ANC filter to remove the interference signal centred at 60Hz. The GW signal is indicated by diagonal dashed line. \textcolor{red}{TK: high contrast version also available. What are the settings?}}
%DIF < \end{figure*}
%DIF < 
%DIF < 
%DIF < 
%DIFDELCMD < 

%DIFDELCMD < %%%
%DIF < 
%DIF < 
%DIF < 
%DIF < 
%DIF < \section{Old material}
%DIF < 
%DIF < 
%DIF < 
%DIF < 
%DIF < 
%DIF < \begin{figure*}
%DIF < 	\begin{center}
%DIF < 		\includegraphics[width=\textwidth]{result_images/before_and_after.jpg}
%DIF < 	\end{center}
%DIF < 	\caption{\label{frequency tracking before and after}
%DIF < 		Tracking of the frequency evolution of a continuous GW with SNR$_{\rm in} = 0.025$, $H(\omega) =4$ and $\Delta f = 0.5$ using a HMM Viterbi algorithm both before (left hand panel) and after (right hand panel) the application of the ANC filter to remove the interference signal centred at 60Hz. The GW signal is indicated by diagonal dashed line. \textcolor{red}{TK: What is the y axis? This should be two separate figures. Make red line clearer in RHS}}
%DIF < \end{figure*}
%DIF < 
%DIF < 
%DIF < 
%DIF < 
%DIF < \begin{figure}[h!]
%DIF < 	\begin{center}
%DIF < 		\includegraphics[width=0.49\textwidth]{result_images/frequency_difference_crop.pdf}
%DIF < 	\end{center}
%DIF < 	\caption{\label{fig:frequency difference}
%DIF < 		ROCs under different $\Delta f$ with $|H(w)|=3$ and $\rm{SNR}_{\rm in}=0.025$}
%DIF < \end{figure}
%DIF < \begin{figure}[h!]
%DIF < 	\begin{center}
%DIF < 		\includegraphics[width=0.49\textwidth]{result_images/homega_crop.pdf}
%DIF < 	\end{center}
%DIF < 	\caption{\label{fig:H(w)}
%DIF < 		ROCs under different $|H(w)|$ with $\Delta f=0.5$ and $\rm{SNR}_{\rm in}=0.02$ \textcolor{red}{TK:change ordering of subplots so both delta f and H increase}}
%DIF < \end{figure}
%DIF < 
%DIF < 
%DIF < 
%DIF < \begin{figure}
%DIF < 	\begin{center}
%DIF < 		\includegraphics[width=0.49\textwidth]{result_images/frequency_tracking.pdf}
%DIF < 	\end{center}
%DIF < 	\caption{\label{frequency tracking}
%DIF < 		Frequency tracking after RLS: $\rm{SNR}_{\rm in}=0.025$, $\Delta f = 0.5$, $|H(w)|=4$. \textcolor{red}{TK: Update this figure. Remove legend. Is this interference frequency or gw frequency?}}
%DIF < \end{figure}
%DIF < 
%DIF < \begin{figure}
%DIF < 	\begin{center}
%DIF < 		\includegraphics[width=0.49\textwidth]{result_images/taps2_frequency.pdf}
%DIF < 	\end{center}
%DIF < 	\caption{\label{taps_freq}
%DIF < 		Frequency spectrum of the adaptive filter after converging. \textcolor{red}{TK: Update caption TBD}}
%DIF < \end{figure}
%DIF < 
%DIF < 
%DIF < \begin{figure}
%DIF < 	\begin{center}
%DIF < 		\includegraphics[width=0.49\textwidth]{result_images/taps2_time.pdf}
%DIF < 	\end{center}
%DIF < 	\caption{\label{taps}
%DIF < 		Impulse response of the adaptive filter after converging. \textcolor{red}{TK: Clean up figure e.g. axis labels What is the x axis?}}
%DIF < \end{figure}
%DIFDELCMD < 

%DIFDELCMD < %%%
\DIFdelend %\bibliographystyle{myunsrt}
\bibliographystyle{apsrev4-1} % Tell bibtex which bibliography style to use

\bibliography{bibLinesPaper}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\begin{acknowledgements}
%GWOSC
This research has made use of data, software and/or web tools obtained from the Gravitational Wave Open Science Center (https://www.gw-openscience.org), a service of LIGO Laboratory, the LIGO Scientific Collaboration and the Virgo Collaboration. LIGO is funded by the U.S. National Science Foundation. Virgo is funded by the French Centre National de Recherche Scientifique (CNRS), the Italian Istituto Nazionale della Fisica Nucleare (INFN) and the Dutch Nikhef, with contributions by Polish and Hungarian institutes. This research was supported by
the Australian Research Council \DIFaddbegin \DIFadd{(ARC) }\DIFaddend Centre of Excellence for Gravitational Wave Discovery (OzGrav), grant number CE170100004\DIFdelbegin \DIFdel{.
}\DIFdelend \DIFaddbegin \DIFadd{, and ARC Discovery Project DP170103625. \textcolor{red}{TK: other author fundings to be added here}
}\DIFaddend \end{acknowledgements}


\end{document}

